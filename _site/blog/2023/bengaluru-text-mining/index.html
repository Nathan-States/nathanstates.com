<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nathan States">
<meta name="dcterms.date" content="2023-01-22">
<meta name="description" content="Analyzing over 100,000 complaints from the Silicon Valley of India.">

<title>Nathan States - Bengaluru Text Mining</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="../../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="../../../site_libs/echarts4r-4.8.0/echarts-en.min.js"></script>
<script src="../../../site_libs/echarts4r-4.8.0/ecStat.min.js"></script>
<script src="../../../site_libs/echarts4r-4.8.0/dataTool.min.js"></script>
<script src="../../../site_libs/echarts4r-binding-0.4.4/echarts4r.js"></script>
<link href="../../../site_libs/wordcloud2-0.0.1/wordcloud.css" rel="stylesheet">
<script src="../../../site_libs/wordcloud2-0.0.1/wordcloud2-all.js"></script>
<script src="../../../site_libs/wordcloud2-0.0.1/hover.js"></script>
<script src="../../../site_libs/wordcloud2-binding-0.2.1/wordcloud2.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../../assets/styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">nathan<span class="icon-line"></span>states_</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../projects.html">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../archives.html">
 <span class="menu-text">Archives</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../notes.html">
 <span class="menu-text">Notes</span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Bengaluru Text Mining</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          Analyzing over 100,000 complaints from the <em>Silicon Valley</em> of India.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">text_mining</div>
                <div class="quarto-category">machine_learning</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Nathan States </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 22, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#results" id="toc-results" class="nav-link active" data-scroll-target="#results">Results</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling">Data Wrangling</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#number-of-grievances-by-day" id="toc-number-of-grievances-by-day" class="nav-link" data-scroll-target="#number-of-grievances-by-day">Number of Grievances By Day</a></li>
  <li><a href="#grievances-by-category" id="toc-grievances-by-category" class="nav-link" data-scroll-target="#grievances-by-category">Grievances by Category</a></li>
  <li><a href="#grievances-by-subcategory" id="toc-grievances-by-subcategory" class="nav-link" data-scroll-target="#grievances-by-subcategory">Grievances by Subcategory</a></li>
  <li><a href="#most-common-complaint-words" id="toc-most-common-complaint-words" class="nav-link" data-scroll-target="#most-common-complaint-words">Most Common Complaint Words</a></li>
  </ul></li>
  <li><a href="#mle-models" id="toc-mle-models" class="nav-link" data-scroll-target="#mle-models">MLE Models</a>
  <ul class="collapse">
  <li><a href="#preparing-the-data" id="toc-preparing-the-data" class="nav-link" data-scroll-target="#preparing-the-data">Preparing the Data</a></li>
  <li><a href="#text-preprocessing" id="toc-text-preprocessing" class="nav-link" data-scroll-target="#text-preprocessing">Text Preprocessing</a></li>
  <li><a href="#building-the-models" id="toc-building-the-models" class="nav-link" data-scroll-target="#building-the-models">Building the Models</a></li>
  <li><a href="#results-1" id="toc-results-1" class="nav-link" data-scroll-target="#results-1">Results</a></li>
  </ul></li>
  <li><a href="#improvements" id="toc-improvements" class="nav-link" data-scroll-target="#improvements">Improvements</a>
  <ul class="collapse">
  <li><a href="#modifications" id="toc-modifications" class="nav-link" data-scroll-target="#modifications">Modifications</a></li>
  <li><a href="#redo-text-preprocessing" id="toc-redo-text-preprocessing" class="nav-link" data-scroll-target="#redo-text-preprocessing">Redo Text Preprocessing</a></li>
  <li><a href="#new-results" id="toc-new-results" class="nav-link" data-scroll-target="#new-results">New Results</a></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  <li><a href="#source" id="toc-source" class="nav-link" data-scroll-target="#source">Source</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="_images/preview.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Aerial view of <em>Bengaluru</em>, India.</figcaption><p></p>
</figure>
</div>
<p><br></p>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<ul>
<li>Over <strong>80%</strong> of complaints filed were related to street lights not working, road maintenance, or garbage collection issues.</li>
<li>Of the four classification models, the linear support vector classifier performed the best, recording <strong>88.773%</strong> accuracy. The top three models all performed similarly as well, though, all falling within three percentage points.</li>
<li>Improvements were made by increasing the number of stop words, as well as combining smaller categories into larger ones. Using LinearSVC, these changes led to a 3.214% increase, ultimately recording an accuracy of <strong>91.987%</strong>.</li>
<li>Further improvements can be made by adding to the stop word list, changing the contents of the “Others” category, and adjusting the downsampling of the model.</li>
</ul>
</section>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>Text data can be difficult to analyze in large amounts, but raw text is invaluable in numerous different ways. Using simple Python libraries, modern machine learning models can parse thousands of rows in seconds, which can be used for a variety of purposes. One of the most common of these is <em>classification</em>, or categorizing text into different groups.</p>
<p>The <em>Bruhat Bengaluru Mahangara Palike</em> (BBMP) - an administrative body that oversees city development in Bengaluru, the largest tech city in India - created a web application that allows citizens to file grievances with the city. From February 8th, 2020 to February 21st, 2021, a total of <strong>105,956</strong> complaints were filed to BBMP, or about 280 a day. Exploring this data not only provides insight into the most common problems facing this city (or at least the complaints most likely to be sent), but also presents an opportunity to quantify and categorize them.</p>
<p>In the dataset, complaints have been manually categorized by the administrators who oversee the app at BBMP, but this is extremely inefficient. Usefully, though, the developers have already created categories that they felt best sorted the data, which means, assuming complaints don’t change substantially in the future, we can train a machine learning model that performs this task automatically. This could save hours and hours of time.</p>
<p>Because the categories are already defined, this will be a <strong>supervised</strong> classification model.</p>
</section>
<section id="data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling">Data Wrangling</h2>
<p>Data wrangling and EDA done using <code>R</code>.</p>
<p>First, we import the data and the libraries we will be using.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(echarts4r)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wordcloud2)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Set Directory </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">set_here</span>()</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Data</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>grievances <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"bengaluru-grievances.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The admins at BBMP keep their data neat and tidy, so there’s not many problems to fix. There are a couple things to consider, however.</p>
<p>The first issue is that some descriptions are extremely short, making classifying them accurately near impossible. We can limit the number of characters that a complaint must have, though the appropriate number of rows to remove is debatable. Ideally, we don’t want to exclude too much of the data while still removing descriptions too short to be properly categorized.</p>
<p>Using <code>str_length</code> from the <code>stringr</code> package, we see 5,392 complaints contained fewer than 12 characters, meaning removing them would still preserve 95% of the original data. Using <code>filter</code> from <code>dplyr</code>, we can keep all complaints containing more than 12 characters.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Counting number of rows </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>grievances <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_length</span>(description) <span class="sc">&lt;</span> <span class="dv">12</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 1
      n
  &lt;int&gt;
1  5392</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing those rows </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>grievances <span class="ot">&lt;-</span> grievances <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_length</span>(description) <span class="sc">&gt;</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The other consideration is whether the existing categories accurately reflect the data or not. It’s possible certain similarities between different categories would better be combined into one, and likewise, single categories that should be multiple ones. These changes might not only provide a better description of the data, but improve accuracy in the long run.</p>
<p>For now, we will leave the original categories intact and proceed, but future models may benefit from this step.</p>
</section>
<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h2>
<p>Interactive charts created using <code>echarts4r</code>.</p>
<section id="number-of-grievances-by-day" class="level3">
<h3 class="anchored" data-anchor-id="number-of-grievances-by-day">Number of Grievances By Day</h3>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set Theme </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">e_common</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">font_family =</span> <span class="st">"Georgia"</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Chart </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>grievances <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">created_at =</span> <span class="fu">as.Date</span>(created_at)) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_charts</span>(created_at) <span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_line</span>(Total, <span class="at">symbol =</span> <span class="st">"none"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_x_axis</span>(<span class="at">axisLabel =</span> <span class="fu">list</span>(<span class="at">interval =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_title</span>(</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="st">"Total number of grievances by day"</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtext =</span> <span class="st">"Data: BBMP"</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_color</span>(</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#0a32d2"</span>, </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">background =</span> <span class="st">"rgb(0, 0, 0, 0)"</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_legend</span>(<span class="at">show =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_tooltip</span>(</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">backgroundColor =</span> <span class="st">"rgba(20, 20, 20, 0.5)"</span>,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">borderColor =</span> <span class="st">"rgba(0, 0, 0, 0)"</span>,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">textStyle =</span> <span class="fu">list</span>(</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"#ffffff"</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">trigger =</span> <span class="st">"axis"</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-c984baf893ab31d65e74" style="width:100%;height:500px;" class="echarts4r html-widget"></div>
<script type="application/json" data-for="htmlwidget-c984baf893ab31d65e74">{"x":{"theme":"","tl":false,"draw":true,"renderer":"canvas","events":[],"buttons":[],"opts":{"yAxis":[{"show":true}],"xAxis":[{"data":["2020-02-08","2020-02-09","2020-02-10","2020-02-11","2020-02-12","2020-02-13","2020-02-14","2020-02-15","2020-02-16","2020-02-17","2020-02-18","2020-02-19","2020-02-20","2020-02-21","2020-02-22","2020-02-23","2020-02-24","2020-02-25","2020-02-26","2020-02-27","2020-02-28","2020-02-29","2020-03-01","2020-03-02","2020-03-03","2020-03-04","2020-03-05","2020-03-06","2020-03-07","2020-03-08","2020-03-09","2020-03-10","2020-03-11","2020-03-12","2020-03-13","2020-03-14","2020-03-15","2020-03-16","2020-03-17","2020-03-18","2020-03-19","2020-03-20","2020-03-21","2020-03-22","2020-03-23","2020-03-24","2020-03-25","2020-03-26","2020-03-27","2020-03-28","2020-03-29","2020-03-30","2020-03-31","2020-04-01","2020-04-02","2020-04-03","2020-04-04","2020-04-05","2020-04-06","2020-04-07","2020-04-08","2020-04-09","2020-04-10","2020-04-11","2020-04-12","2020-04-13","2020-04-14","2020-04-15","2020-04-16","2020-04-17","2020-04-18","2020-04-19","2020-04-20","2020-04-21","2020-04-22","2020-04-23","2020-04-24","2020-04-25","2020-04-26","2020-04-27","2020-04-28","2020-04-29","2020-04-30","2020-05-01","2020-05-02","2020-05-03","2020-05-04","2020-05-05","2020-05-06","2020-05-07","2020-05-08","2020-05-09","2020-05-10","2020-05-11","2020-05-12","2020-05-13","2020-05-14","2020-05-15","2020-05-16","2020-05-17","2020-05-18","2020-05-19","2020-05-20","2020-05-21","2020-05-22","2020-05-23","2020-05-24","2020-05-25","2020-05-26","2020-05-27","2020-05-28","2020-05-29","2020-05-30","2020-05-31","2020-06-01","2020-06-02","2020-06-03","2020-06-04","2020-06-05","2020-06-06","2020-06-07","2020-06-08","2020-06-09","2020-06-10","2020-06-11","2020-06-12","2020-06-13","2020-06-14","2020-06-15","2020-06-16","2020-06-17","2020-06-18","2020-06-19","2020-06-20","2020-06-21","2020-06-22","2020-06-23","2020-06-24","2020-06-25","2020-06-26","2020-06-27","2020-06-28","2020-06-29","2020-06-30","2020-07-01","2020-07-02","2020-07-03","2020-07-04","2020-07-05","2020-07-06","2020-07-07","2020-07-08","2020-07-09","2020-07-10","2020-07-11","2020-07-12","2020-07-13","2020-07-14","2020-07-15","2020-07-16","2020-07-17","2020-07-18","2020-07-19","2020-07-20","2020-07-21","2020-07-22","2020-07-23","2020-07-24","2020-07-25","2020-07-26","2020-07-27","2020-07-28","2020-07-29","2020-07-30","2020-07-31","2020-08-01","2020-08-02","2020-08-03","2020-08-04","2020-08-05","2020-08-06","2020-08-07","2020-08-08","2020-08-09","2020-08-10","2020-08-11","2020-08-12","2020-08-13","2020-08-14","2020-08-15","2020-08-16","2020-08-17","2020-08-18","2020-08-19","2020-08-20","2020-08-21","2020-08-22","2020-08-23","2020-08-24","2020-08-25","2020-08-26","2020-08-27","2020-08-28","2020-08-29","2020-08-30","2020-08-31","2020-09-01","2020-09-02","2020-09-03","2020-09-04","2020-09-05","2020-09-06","2020-09-07","2020-09-08","2020-09-09","2020-09-10","2020-09-11","2020-09-12","2020-09-13","2020-09-14","2020-09-15","2020-09-16","2020-09-17","2020-09-18","2020-09-19","2020-09-20","2020-09-21","2020-09-22","2020-09-23","2020-09-24","2020-09-25","2020-09-26","2020-09-27","2020-09-28","2020-09-29","2020-09-30","2020-10-01","2020-10-02","2020-10-03","2020-10-04","2020-10-05","2020-10-06","2020-10-07","2020-10-08","2020-10-09","2020-10-10","2020-10-11","2020-10-12","2020-10-13","2020-10-14","2020-10-15","2020-10-16","2020-10-17","2020-10-18","2020-10-19","2020-10-20","2020-10-21","2020-10-22","2020-10-23","2020-10-24","2020-10-25","2020-10-26","2020-10-27","2020-10-28","2020-10-29","2020-10-30","2020-10-31","2020-11-01","2020-11-02","2020-11-03","2020-11-04","2020-11-05","2020-11-06","2020-11-07","2020-11-08","2020-11-09","2020-11-10","2020-11-11","2020-11-12","2020-11-13","2020-11-14","2020-11-15","2020-11-16","2020-11-17","2020-11-18","2020-11-19","2020-11-20","2020-11-21","2020-11-22","2020-11-23","2020-11-24","2020-11-25","2020-11-26","2020-11-27","2020-11-28","2020-11-29","2020-11-30","2020-12-01","2020-12-02","2020-12-03","2020-12-04","2020-12-05","2020-12-06","2020-12-07","2020-12-08","2020-12-09","2020-12-10","2020-12-11","2020-12-12","2020-12-13","2020-12-14","2020-12-15","2020-12-16","2020-12-17","2020-12-18","2020-12-19","2020-12-20","2020-12-21","2020-12-22","2020-12-23","2020-12-24","2020-12-25","2020-12-26","2020-12-27","2020-12-28","2020-12-29","2020-12-30","2020-12-31","2021-01-01","2021-01-02","2021-01-03","2021-01-04","2021-01-05","2021-01-06","2021-01-07","2021-01-08","2021-01-09","2021-01-10","2021-01-11","2021-01-12","2021-01-13","2021-01-14","2021-01-15","2021-01-16","2021-01-17","2021-01-18","2021-01-19","2021-01-20","2021-01-21","2021-01-22","2021-01-23","2021-01-24","2021-01-25","2021-01-26","2021-01-27","2021-01-28","2021-01-29","2021-01-30","2021-01-31","2021-02-01","2021-02-02","2021-02-03","2021-02-04","2021-02-05","2021-02-06","2021-02-07","2021-02-08","2021-02-09","2021-02-10","2021-02-11","2021-02-12","2021-02-13","2021-02-14","2021-02-15","2021-02-16","2021-02-17","2021-02-18","2021-02-19","2021-02-20","2021-02-21"],"type":"time","boundaryGap":true,"axisLabel":{"interval":0}}],"legend":{"data":["Total"],"show":false,"type":"plain"},"series":[{"data":[{"value":["2020-02-08","228"]},{"value":["2020-02-09","339"]},{"value":["2020-02-10","244"]},{"value":["2020-02-11","325"]},{"value":["2020-02-12","280"]},{"value":["2020-02-13","222"]},{"value":["2020-02-14","307"]},{"value":["2020-02-15","319"]},{"value":["2020-02-16","209"]},{"value":["2020-02-17","234"]},{"value":["2020-02-18","239"]},{"value":["2020-02-19","320"]},{"value":["2020-02-20","235"]},{"value":["2020-02-21","139"]},{"value":["2020-02-22","225"]},{"value":["2020-02-23","190"]},{"value":["2020-02-24","268"]},{"value":["2020-02-25","340"]},{"value":["2020-02-26","294"]},{"value":["2020-02-27","295"]},{"value":["2020-02-28","312"]},{"value":["2020-02-29","742"]},{"value":["2020-03-01","357"]},{"value":["2020-03-02","371"]},{"value":["2020-03-03","378"]},{"value":["2020-03-04","366"]},{"value":["2020-03-05","350"]},{"value":["2020-03-06","358"]},{"value":["2020-03-07","388"]},{"value":["2020-03-08","306"]},{"value":["2020-03-09","363"]},{"value":["2020-03-10","389"]},{"value":["2020-03-11","354"]},{"value":["2020-03-12","332"]},{"value":["2020-03-13","313"]},{"value":["2020-03-14","294"]},{"value":["2020-03-15","230"]},{"value":["2020-03-16","390"]},{"value":["2020-03-17","348"]},{"value":["2020-03-18","396"]},{"value":["2020-03-19","302"]},{"value":["2020-03-20","311"]},{"value":["2020-03-21","362"]},{"value":["2020-03-22","148"]},{"value":["2020-03-23","343"]},{"value":["2020-03-24","151"]},{"value":["2020-03-25","176"]},{"value":["2020-03-26","179"]},{"value":["2020-03-27","125"]},{"value":["2020-03-28","136"]},{"value":["2020-03-29","176"]},{"value":["2020-03-30","251"]},{"value":["2020-03-31","199"]},{"value":["2020-04-01","164"]},{"value":["2020-04-02","152"]},{"value":["2020-04-03","125"]},{"value":["2020-04-04","164"]},{"value":["2020-04-05","110"]},{"value":["2020-04-06","137"]},{"value":["2020-04-07","188"]},{"value":["2020-04-08","149"]},{"value":["2020-04-09","177"]},{"value":["2020-04-10","183"]},{"value":["2020-04-11","178"]},{"value":["2020-04-12","126"]},{"value":["2020-04-13","132"]},{"value":["2020-04-14","154"]},{"value":["2020-04-15","165"]},{"value":["2020-04-16","134"]},{"value":["2020-04-17","128"]},{"value":["2020-04-18","139"]},{"value":["2020-04-19","117"]},{"value":["2020-04-20","160"]},{"value":["2020-04-21","137"]},{"value":["2020-04-22","136"]},{"value":["2020-04-23","161"]},{"value":["2020-04-24","180"]},{"value":["2020-04-25","151"]},{"value":["2020-04-26","126"]},{"value":["2020-04-27","176"]},{"value":["2020-04-28","148"]},{"value":["2020-04-29","256"]},{"value":["2020-04-30","193"]},{"value":["2020-05-01","144"]},{"value":["2020-05-02","167"]},{"value":["2020-05-03","144"]},{"value":["2020-05-04","229"]},{"value":["2020-05-05","188"]},{"value":["2020-05-06","182"]},{"value":["2020-05-07","225"]},{"value":["2020-05-08","154"]},{"value":["2020-05-09","225"]},{"value":["2020-05-10","162"]},{"value":["2020-05-11","180"]},{"value":["2020-05-12","212"]},{"value":["2020-05-13","234"]},{"value":["2020-05-14","180"]},{"value":["2020-05-15","215"]},{"value":["2020-05-16","215"]},{"value":["2020-05-17","184"]},{"value":["2020-05-18","162"]},{"value":["2020-05-19","188"]},{"value":["2020-05-20","199"]},{"value":["2020-05-21","227"]},{"value":["2020-05-22","174"]},{"value":["2020-05-23","224"]},{"value":["2020-05-24","206"]},{"value":["2020-05-25","338"]},{"value":["2020-05-26","312"]},{"value":["2020-05-27","342"]},{"value":["2020-05-28","280"]},{"value":["2020-05-29","245"]},{"value":["2020-05-30","331"]},{"value":["2020-05-31","305"]},{"value":["2020-06-01","329"]},{"value":["2020-06-02","390"]},{"value":["2020-06-03","320"]},{"value":["2020-06-04","302"]},{"value":["2020-06-05","311"]},{"value":["2020-06-06","297"]},{"value":["2020-06-07","221"]},{"value":["2020-06-08","349"]},{"value":["2020-06-09","381"]},{"value":["2020-06-10","315"]},{"value":["2020-06-11","278"]},{"value":["2020-06-12","279"]},{"value":["2020-06-13","258"]},{"value":["2020-06-14","210"]},{"value":["2020-06-15","281"]},{"value":["2020-06-16","297"]},{"value":["2020-06-17","288"]},{"value":["2020-06-18","306"]},{"value":["2020-06-19","260"]},{"value":["2020-06-20","293"]},{"value":["2020-06-21","163"]},{"value":["2020-06-22","287"]},{"value":["2020-06-23","265"]},{"value":["2020-06-24","222"]},{"value":["2020-06-25","316"]},{"value":["2020-06-26","250"]},{"value":["2020-06-27","237"]},{"value":["2020-06-28","192"]},{"value":["2020-06-29","294"]},{"value":["2020-06-30","268"]},{"value":["2020-07-01","263"]},{"value":["2020-07-02","249"]},{"value":["2020-07-03","249"]},{"value":["2020-07-04","205"]},{"value":["2020-07-05","192"]},{"value":["2020-07-06","278"]},{"value":["2020-07-07","306"]},{"value":["2020-07-08","340"]},{"value":["2020-07-09","277"]},{"value":["2020-07-10","301"]},{"value":["2020-07-11","269"]},{"value":["2020-07-12","271"]},{"value":["2020-07-13","266"]},{"value":["2020-07-14","126"]},{"value":["2020-07-15","134"]},{"value":["2020-07-16","157"]},{"value":["2020-07-17","194"]},{"value":["2020-07-18","189"]},{"value":["2020-07-19","156"]},{"value":["2020-07-20","252"]},{"value":["2020-07-21","248"]},{"value":["2020-07-22","260"]},{"value":["2020-07-23","251"]},{"value":["2020-07-24","268"]},{"value":["2020-07-25","268"]},{"value":["2020-07-26","184"]},{"value":["2020-07-27","279"]},{"value":["2020-07-28","185"]},{"value":["2020-07-29","284"]},{"value":["2020-07-30","252"]},{"value":["2020-07-31","154"]},{"value":["2020-08-01","225"]},{"value":["2020-08-02","151"]},{"value":["2020-08-03","276"]},{"value":["2020-08-04","237"]},{"value":["2020-08-05","237"]},{"value":["2020-08-06","249"]},{"value":["2020-08-07","232"]},{"value":["2020-08-08","208"]},{"value":["2020-08-09","144"]},{"value":["2020-08-10","278"]},{"value":["2020-08-11","263"]},{"value":["2020-08-12","278"]},{"value":["2020-08-13","293"]},{"value":["2020-08-14","254"]},{"value":["2020-08-15","165"]},{"value":["2020-08-16","194"]},{"value":["2020-08-17","256"]},{"value":["2020-08-18","298"]},{"value":["2020-08-19","275"]},{"value":["2020-08-20","289"]},{"value":["2020-08-21","216"]},{"value":["2020-08-22","142"]},{"value":["2020-08-23","209"]},{"value":["2020-08-24","258"]},{"value":["2020-08-25","279"]},{"value":["2020-08-26","221"]},{"value":["2020-08-27","219"]},{"value":["2020-08-28","255"]},{"value":["2020-08-29","247"]},{"value":["2020-08-30","183"]},{"value":["2020-08-31","302"]},{"value":["2020-09-01","280"]},{"value":["2020-09-02","265"]},{"value":["2020-09-03","314"]},{"value":["2020-09-04","281"]},{"value":["2020-09-05","289"]},{"value":["2020-09-06","211"]},{"value":["2020-09-07","387"]},{"value":["2020-09-08","407"]},{"value":["2020-09-09","409"]},{"value":["2020-09-10","359"]},{"value":["2020-09-11","340"]},{"value":["2020-09-12","311"]},{"value":["2020-09-13","238"]},{"value":["2020-09-14","308"]},{"value":["2020-09-15","283"]},{"value":["2020-09-16","306"]},{"value":["2020-09-17","275"]},{"value":["2020-09-18","269"]},{"value":["2020-09-19","289"]},{"value":["2020-09-20","182"]},{"value":["2020-09-21","268"]},{"value":["2020-09-22","283"]},{"value":["2020-09-23","327"]},{"value":["2020-09-24","338"]},{"value":["2020-09-25","265"]},{"value":["2020-09-26","234"]},{"value":["2020-09-27","211"]},{"value":["2020-09-28","357"]},{"value":["2020-09-29","351"]},{"value":["2020-09-30","369"]},{"value":["2020-10-01","345"]},{"value":["2020-10-02","329"]},{"value":["2020-10-03","391"]},{"value":["2020-10-04","244"]},{"value":["2020-10-05","325"]},{"value":["2020-10-06","368"]},{"value":["2020-10-07","286"]},{"value":["2020-10-08","313"]},{"value":["2020-10-09","315"]},{"value":["2020-10-10","275"]},{"value":["2020-10-11","322"]},{"value":["2020-10-12","405"]},{"value":["2020-10-13","325"]},{"value":["2020-10-14","339"]},{"value":["2020-10-15","275"]},{"value":["2020-10-16","282"]},{"value":["2020-10-17","262"]},{"value":["2020-10-18","256"]},{"value":["2020-10-19","375"]},{"value":["2020-10-20","400"]},{"value":["2020-10-21","459"]},{"value":["2020-10-22","388"]},{"value":["2020-10-23","426"]},{"value":["2020-10-24","363"]},{"value":["2020-10-25","221"]},{"value":["2020-10-26","349"]},{"value":["2020-10-27","446"]},{"value":["2020-10-28","466"]},{"value":["2020-10-29","374"]},{"value":["2020-10-30","311"]},{"value":["2020-10-31","320"]},{"value":["2020-11-01","214"]},{"value":["2020-11-02","283"]},{"value":["2020-11-03","311"]},{"value":["2020-11-04","349"]},{"value":["2020-11-05","341"]},{"value":["2020-11-06","331"]},{"value":["2020-11-07","313"]},{"value":["2020-11-08","254"]},{"value":["2020-11-09","465"]},{"value":["2020-11-10","300"]},{"value":["2020-11-11","290"]},{"value":["2020-11-12","294"]},{"value":["2020-11-13","242"]},{"value":["2020-11-14","206"]},{"value":["2020-11-15","180"]},{"value":["2020-11-16","239"]},{"value":["2020-11-17","289"]},{"value":["2020-11-18","277"]},{"value":["2020-11-19","281"]},{"value":["2020-11-20","251"]},{"value":["2020-11-21","245"]},{"value":["2020-11-22","243"]},{"value":["2020-11-23","252"]},{"value":["2020-11-24","288"]},{"value":["2020-11-25","316"]},{"value":["2020-11-26","172"]},{"value":["2020-11-27","319"]},{"value":["2020-11-28","361"]},{"value":["2020-11-29","219"]},{"value":["2020-11-30","340"]},{"value":["2020-12-01","289"]},{"value":["2020-12-02","297"]},{"value":["2020-12-03","248"]},{"value":["2020-12-04","212"]},{"value":["2020-12-05","274"]},{"value":["2020-12-06","208"]},{"value":["2020-12-07","285"]},{"value":["2020-12-08","248"]},{"value":["2020-12-09","276"]},{"value":["2020-12-10","251"]},{"value":["2020-12-11","200"]},{"value":["2020-12-12","281"]},{"value":["2020-12-13","168"]},{"value":["2020-12-14","303"]},{"value":["2020-12-15","246"]},{"value":["2020-12-16","270"]},{"value":["2020-12-17","265"]},{"value":["2020-12-18","272"]},{"value":["2020-12-19","205"]},{"value":["2020-12-20","207"]},{"value":["2020-12-21","283"]},{"value":["2020-12-22","292"]},{"value":["2020-12-23","261"]},{"value":["2020-12-24","236"]},{"value":["2020-12-25","227"]},{"value":["2020-12-26","243"]},{"value":["2020-12-27","181"]},{"value":["2020-12-28","256"]},{"value":["2020-12-29","226"]},{"value":["2020-12-30","262"]},{"value":["2020-12-31","218"]},{"value":["2021-01-01","158"]},{"value":["2021-01-02","192"]},{"value":["2021-01-03","148"]},{"value":["2021-01-04","277"]},{"value":["2021-01-05","263"]},{"value":["2021-01-06","204"]},{"value":["2021-01-07","218"]},{"value":["2021-01-08","225"]},{"value":["2021-01-09","285"]},{"value":["2021-01-10","232"]},{"value":["2021-01-11","300"]},{"value":["2021-01-12","373"]},{"value":["2021-01-13","261"]},{"value":["2021-01-14","215"]},{"value":["2021-01-15","226"]},{"value":["2021-01-16","289"]},{"value":["2021-01-17","210"]},{"value":["2021-01-18","268"]},{"value":["2021-01-19","273"]},{"value":["2021-01-20","224"]},{"value":["2021-01-21","269"]},{"value":["2021-01-22","294"]},{"value":["2021-01-23","206"]},{"value":["2021-01-24","171"]},{"value":["2021-01-25","261"]},{"value":["2021-01-26","257"]},{"value":["2021-01-27","308"]},{"value":["2021-01-28","272"]},{"value":["2021-01-29","285"]},{"value":["2021-01-30","264"]},{"value":["2021-01-31","246"]},{"value":["2021-02-01","339"]},{"value":["2021-02-02","236"]},{"value":["2021-02-03","302"]},{"value":["2021-02-04","259"]},{"value":["2021-02-05","237"]},{"value":["2021-02-06","238"]},{"value":["2021-02-07","251"]},{"value":["2021-02-08","328"]},{"value":["2021-02-09","278"]},{"value":["2021-02-10","268"]},{"value":["2021-02-11","268"]},{"value":["2021-02-12","242"]},{"value":["2021-02-13","242"]},{"value":["2021-02-14","171"]},{"value":["2021-02-15","297"]},{"value":["2021-02-16","305"]},{"value":["2021-02-17","287"]},{"value":["2021-02-18","274"]},{"value":["2021-02-19","293"]},{"value":["2021-02-20","258"]},{"value":["2021-02-21","213"]}],"yAxisIndex":0,"xAxisIndex":0,"name":"Total","type":"line","coordinateSystem":"cartesian2d","symbol":"none"}],"title":[{"text":"Total number of grievances by day","subtext":"Data: BBMP"}],"color":["#0a32d2"],"backgroundColor":"rgb(0, 0, 0, 0)","tooltip":{"trigger":"axis","backgroundColor":"rgba(20, 20, 20, 0.5)","borderColor":"rgba(0, 0, 0, 0)","textStyle":{"color":"#ffffff"}},"textStyle":{"fontFamily":"Georgia"}},"dispose":true},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>On most days, grievances would vary between 200 to 400 a day, with some spikes in September onwards, including a massive single-day one in March of 742. On average, 280 complaints were filed each day.</p>
<p>Because complaints don’t seem to fluctuate significantly, we can likely assume that the day the grievance was filed isn’t indicative of its contents.</p>
</section>
<section id="grievances-by-category" class="level3">
<h3 class="anchored" data-anchor-id="grievances-by-category">Grievances by Category</h3>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>grievances <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(category) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Total)) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Total <span class="sc">&gt;</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_charts</span>(category) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_bar</span>(Total) <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_x_axis</span>(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabel =</span> <span class="fu">list</span>(</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">interval =</span> <span class="dv">0</span>, </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">rotate =</span> <span class="dv">45</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">fontSize =</span> <span class="fl">9.25</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_title</span>(</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="st">"Most common grievances by category"</span>, </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtext =</span> <span class="st">"Only categories above 1,000 visible"</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_legend</span>(<span class="at">show =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_labels</span>(<span class="at">show =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_color</span>(</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#8c5ac8"</span>, </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">background =</span> <span class="st">"rgb(0, 0, 0, 0)"</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_tooltip</span>(</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">trigger =</span> <span class="st">"axis"</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">backgroundColor =</span> <span class="st">"rgba(20, 20, 20, 0.5)"</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">borderColor =</span> <span class="st">"rgba(0, 0, 0, 0)"</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">textStyle =</span> <span class="fu">list</span>(</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"#ffffff"</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-f5638006b710470f48f4" style="width:100%;height:500px;" class="echarts4r html-widget"></div>
<script type="application/json" data-for="htmlwidget-f5638006b710470f48f4">{"x":{"theme":"","tl":false,"draw":true,"renderer":"canvas","events":[],"buttons":[],"opts":{"yAxis":[{"show":true}],"xAxis":[{"data":["Electrical","Solid Waste (Garbage) Related","Road Maintenance(Engg)","Forest","Animal control","Health Dept","Revenue Department","CORONA COVID19","Others"],"type":"category","boundaryGap":true,"axisLabel":{"interval":0,"rotate":45,"fontSize":9.25}}],"legend":{"data":["Total"],"show":false,"type":"plain"},"series":[{"data":[{"value":["Electrical","38619"]},{"value":["Solid Waste (Garbage) Related","25177"]},{"value":["Road Maintenance(Engg)","17259"]},{"value":["Forest"," 4397"]},{"value":["Animal control"," 4103"]},{"value":["Health Dept"," 3247"]},{"value":["Revenue Department"," 1323"]},{"value":["CORONA COVID19"," 1115"]},{"value":["Others"," 1069"]}],"name":"Total","type":"bar","yAxisIndex":0,"xAxisIndex":0,"coordinateSystem":"cartesian2d","label":{"show":false,"position":"top"}}],"title":[{"text":"Most common grievances by category","subtext":"Only categories above 1,000 visible"}],"color":["#8c5ac8"],"backgroundColor":"rgb(0, 0, 0, 0)","tooltip":{"trigger":"axis","backgroundColor":"rgba(20, 20, 20, 0.5)","borderColor":"rgba(0, 0, 0, 0)","textStyle":{"color":"#ffffff"}},"textStyle":{"fontFamily":"Georgia"}},"dispose":true},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>81.89% of total grievances were categorized as electrical, solid waste or garbage related, or road maintenance. The next three largest categories make up an additional 11.09%, meaning the remaining categories have less than 1,350 occurrences combined.</p>
<p>Note that this is <em>not</em> due to a lack of categories; in fact, there are a total of 20 categories in the data.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(grievances<span class="sc">$</span>category))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20</code></pre>
</div>
</div>
<p>Large imbalances like this are important to consider when building machine learning models. Algorithms are specifically programmed to achieve the highest accuracy regardless of original purposes, and they tend to overestimate larger categories. If a model discovers it can restrict itself to three options while still recording 80%+ accuracy, it will almost always do so.</p>
<p>This means, though, machine learning models will tend to ignore minor categories, because - using our current data as an example - predicting a category outside the top three has an inherent 81.89% <em>fail</em> rate, so this will need to be addressed when creating the models.</p>
<p>There is a question as to whether certain smaller categories should exist at <strong>all</strong>, though.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>grievances <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(category) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(total <span class="sc">&lt;</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 x 2
  category                   total
  &lt;chr&gt;                      &lt;int&gt;
1 Education                     20
2 Estate                        75
3 Markets                       38
4 Optical Fiber Cables (OFC)    62
5 Welfare Schemes               28</code></pre>
</div>
</div>
<p>Five categories have less than 100 complaints total, including two which have less than thirty. This is far too few complaints to reliably build a model with, especially considering we haven’t split the data yet.</p>
</section>
<section id="grievances-by-subcategory" class="level3">
<h3 class="anchored" data-anchor-id="grievances-by-subcategory">Grievances by Subcategory</h3>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>grievances <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subcategory) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Total) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Total <span class="sc">&gt;</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_charts</span>(subcategory) <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_bar</span>(Total) <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_legend</span>(<span class="at">show =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_title</span>(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="st">"Most common grievances by subcategory"</span>, </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtext =</span> <span class="st">"Only categories above 1,000 visible"</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_color</span>(<span class="st">"#8c5ac8"</span>, <span class="at">background =</span> <span class="st">"rgb(0,0,0,0)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_flip_coords</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_tooltip</span>(</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">trigger =</span> <span class="st">"axis"</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">backgroundColor =</span> <span class="st">"rgba(20, 20, 20, 0.5)"</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">borderColor =</span> <span class="st">"rgba(0, 0, 0, 0)"</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">textStyle =</span> <span class="fu">list</span>(</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"#ffffff"</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-da03a40e46dc925743cc" style="width:100%;height:500px;" class="echarts4r html-widget"></div>
<script type="application/json" data-for="htmlwidget-da03a40e46dc925743cc">{"x":{"theme":"","tl":false,"draw":true,"renderer":"canvas","events":[],"buttons":[],"opts":{"xAxis":[{"show":true}],"yAxis":[{"data":["water stagnation","Footpath","Requirement For New Street Lights","Burning of Garbage in Open Space","Dead animal(s)","Road cutting","Garbage dumping in vacant sites","footpath encroachment","Others","obstructions Branches / Trees.","Removal of dead/fallen trees","Debris Removal / Construction Material","Sweeping not done","Animal birth control/neutering of stray dogs","Road side drains","Potholes","Garbage dump","Garbage vehicle not arrived","Street Light Not Working"],"type":"category","boundaryGap":true}],"legend":{"data":["Total"],"show":false,"type":"plain"},"series":[{"data":[{"value":[" 1053","water stagnation"]},{"value":[" 1085","Footpath"]},{"value":[" 1101","Requirement For New Street Lights"]},{"value":[" 1159","Burning of Garbage in Open Space"]},{"value":[" 1271","Dead animal(s)"]},{"value":[" 1439","Road cutting"]},{"value":[" 1466","Garbage dumping in vacant sites"]},{"value":[" 1581","footpath encroachment"]},{"value":[" 1658","Others"]},{"value":[" 1968","obstructions Branches / Trees."]},{"value":[" 2208","Removal of dead/fallen trees"]},{"value":[" 2263","Debris Removal / Construction Material"]},{"value":[" 2715","Sweeping not done"]},{"value":[" 2983","Animal birth control/neutering of stray dogs"]},{"value":[" 3778","Road side drains"]},{"value":[" 5642","Potholes"]},{"value":[" 6719","Garbage dump"]},{"value":[" 9857","Garbage vehicle not arrived"]},{"value":["36397","Street Light Not Working"]}],"name":"Total","type":"bar","yAxisIndex":0,"xAxisIndex":0,"coordinateSystem":"cartesian2d"}],"title":[{"text":"Most common grievances by subcategory","subtext":"Only categories above 1,000 visible"}],"color":["#8c5ac8"],"backgroundColor":"rgb(0,0,0,0)","tooltip":{"trigger":"axis","backgroundColor":"rgba(20, 20, 20, 0.5)","borderColor":"rgba(0, 0, 0, 0)","textStyle":{"color":"#ffffff"}},"textStyle":{"fontFamily":"Georgia"}},"dispose":true},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>While the model being built is only to predict the main categories, by viewing subcategories, we see over 35% of total complaints were related specifically to street lights not working, comprising almost all of the electrical category. Solid waste related problems is divided into two subcategories; garbage vehicle not arriving, and “Garbage dump” (whatever that means). Meanwhile, road maintenance has been divided into three subcategories, those being potholes, road side drains, and debris removal.</p>
</section>
<section id="most-common-complaint-words" class="level3">
<h3 class="anchored" data-anchor-id="most-common-complaint-words">Most Common Complaint Words</h3>
<p>We first have to get the 50 most common words…</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tidy <span class="ot">&lt;-</span> grievances <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, description) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(<span class="fu">get_stopwords</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then chart them using <code>wordcloud2</code>.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordcloud2</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  tidy,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">rep_len</span>(<span class="fu">c</span>(<span class="st">"#8c5ac8"</span>, <span class="st">"#0b0d21"</span>, <span class="st">"#0a32d2"</span>), <span class="fu">nrow</span>(tidy)),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">backgroundColor =</span> <span class="st">"#fcfcfc"</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-6a888df17cb886ddd284" style="width:100%;height:464px;" class="wordcloud2 html-widget"></div>
<script type="application/json" data-for="htmlwidget-6a888df17cb886ddd284">{"x":{"word":["street","light","working","road","garbage","please","days","main","vehicle","cross","water","kindly","house","bbmp","layout","near","lights","also","since","2","action","area","people","request","tree","past","waste","1","side","take","sir","complaint","last","3","one","issue","due","done","dogs","week","arrived","lot","collection","many","coming","problem","front","time","dumped","help"],"freq":[41325,34848,34697,27237,24211,11857,9258,7383,7201,6750,5914,5788,5696,5451,5344,5042,5039,4865,4818,4792,4759,4712,4683,4391,4388,4339,4238,4206,4202,4201,3952,3853,3834,3801,3769,3746,3560,3551,3530,3518,3301,3296,3115,3067,3030,2940,2850,2844,2835,2832],"fontFamily":"Segoe UI","fontWeight":"bold","color":["#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21","#0a32d2","#8c5ac8","#0b0d21"],"minSize":0,"weightFactor":0.0043557168784029,"backgroundColor":"#fcfcfc","gridSize":0,"minRotation":-0.785398163397448,"maxRotation":0.785398163397448,"shuffle":true,"rotateRatio":0.4,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":{"render":[{"code":"function(el,x){\n                        console.log(123);\n                        if(!iii){\n                          window.location.reload();\n                          iii = False;\n\n                        }\n  }","data":null}]}}</script>
</div>
</div>
<p>Seeing as over a third of the data was subcategorized as street lights not working, we see that they are the most common words across all the complaints.</p>
<p>Missing from that is the word <em>not</em>, but this is because we removed all <strong>stop words</strong> from the data. Put simply, stop words are words that don’t add anything to the process of categorizing text. They usually include words like <em>he</em>, <em>she</em>, <em>there</em>, <em>they</em>, <em>I</em>, and so on, which is why they don’t appear in the chart.</p>
<p>The stop words included in the <code>tidytext</code> package (and the ones used in the function above) are meant to apply universally, but if you look closely at the word cloud, there are several words that almost certainly don’t apply to our problem. These include terms like <em>please</em>, <em>kindly</em>, <em>last request</em>, <em>sir</em>, and individual numbers like <em>1</em>, <em>2</em>, and <em>3</em>. While there might exist some incidental correlation between some of these words and their respective categories (perhaps citizens filing animal control complaints are nicer on average, so the term <em>please</em> could be used to identify those complaints more accurately, for example), it’s likely this will just throw off our model’s accuracy in the long run.</p>
<hr>
<p>From the EDA, the primary factors that should be considered when building the models are:</p>
<ol type="1">
<li>Account for imbalances in number of occurrences per category.</li>
<li>Reduce the number of categories by combining them into existing ones.</li>
<li>Add additional stop words.</li>
</ol>
</section>
</section>
<section id="mle-models" class="level2">
<h2 class="anchored" data-anchor-id="mle-models">MLE Models</h2>
<section id="preparing-the-data" class="level3">
<h3 class="anchored" data-anchor-id="preparing-the-data">Preparing the Data</h3>
<p>We’ll opt to use Python for creating the MLE models, as Python libraries are generally more efficient and developed than their R counterparts. Because creating models is computer intensive, the code here has been evaluated locally and presented here for demonstration.</p>
<p>To start, we’ll import the necessary libraries and load the data using <code>pandas</code>. The models here will be built using <code>sklearn</code>.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns  </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> chi2</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> MultinomialNB</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> LinearSVC</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"bengaluru-grievances.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>One of the packages imported here is <code>TfidfVectorizer</code>, which will be the algorithm used to create the models. I’ll explain why I specifically chose this package later on.</p>
<p>Here, I quickly apply the earlier data wrangling techniques by removing complaints less than 12 characters, this time using Python syntax.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reduce Character Limit  </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>character_limit <span class="op">=</span> (df[<span class="st">"description"</span>].<span class="bu">str</span>.<span class="bu">len</span>() <span class="op">&gt;</span> <span class="dv">12</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.loc[character_limit]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A model based on over 100,000 observations is <strong>extremely</strong> hardware intensive, and it causes my laptop to overheat a lot. For practical purposes, we’ll cut down on our data by choosing 15,000 rows at random.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sample(<span class="dv">15000</span>, random_state <span class="op">=</span> <span class="dv">1</span>).copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If we wanted to get another random 15,000 rows, we could change the <code>random_state = 1</code> argument to any other number, like 42, 671, or 7.</p>
<p>With no other changes to be made, we can begin creating the models.</p>
</section>
<section id="text-preprocessing" class="level3">
<h3 class="anchored" data-anchor-id="text-preprocessing">Text Preprocessing</h3>
<p>There are several methods to building models, but the simplest method is to create a new column in our data - we’ll call it <strong>category_id</strong> - that is a factor variable of all existing categories in our data. This essentially amounts to assigning each category a number (Electrical = 0, Road Engineering = 1, etc), which is necessary for getting our model to run properly, as <code>sklearn</code> will not understand strings as factors.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'category_id'</span>] <span class="op">=</span> df[<span class="st">"category"</span>].factorize()[<span class="dv">0</span>]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>category_id_df <span class="op">=</span> df[[<span class="st">"category"</span>, <span class="st">"category_id"</span>]].drop_duplicates()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next, the description column (which stores the text for grievances) needs to be converted to vectors using a chosen algorithm. The algorithm chosen here is <strong>Term Frequency - Inverse Document Frequency</strong> (TF-IDF), which is the product of <span class="math inline">\(TF\)</span> and <span class="math inline">\(IDF\)</span> scores. This is the <code>TfidfVectorizer</code> function that we imported earlier.</p>
<p>It’s useful to present these terms mathematically.</p>
<p><br></p>
<p><strong>Term Frequency</strong>: <span class="math display">\[ TF = \frac{Number \hspace{0.15cm} of \hspace{0.15cm} times \hspace{0.15cm} a \hspace{0.15cm} term \hspace{0.15cm} appears \hspace{0.15cm} in \hspace{0.15cm} the \hspace{0.15cm} description}{Total \hspace{0.15cm} number \hspace{0.15cm} of \hspace{0.15cm} words \hspace{0.15cm} in \hspace{0.15cm} the \hspace{0.15cm} description} \]</span></p>
<p><strong>Inverse Document Frequency</strong>: <span class="math display">\[ IDF = log(\frac{Number \hspace{0.15cm} of \hspace{0.15cm} rows \hspace{0.15cm} in \hspace{0.15cm} a \hspace{0.15cm} data}{Number \hspace{0.15cm} of \hspace{0.15cm} rows \hspace{0.15cm} a \hspace{0.15cm} term \hspace{0.15cm} appears \hspace{0.15cm} in \hspace{0.15cm} a \hspace{0.15cm} data}) \]</span></p>
<p><strong>TF-IDF</strong>: <span class="math display">\[ TF-IDF = TF * IDF \]</span></p>
<p><br></p>
<p>The reason for choosing this algorithm was for the <span class="math inline">\(IDF\)</span> component, which <strong>downsamples</strong> words that appear frequently across all complaints, while adding extra weight to terms that appear less often.</p>
<p>Analyzing it mathematically: as the denominator of the <span class="math inline">\(IDF\)</span> variable increases, the closer it rapidly (more precisely, <em>exponentially</em>) approaches zero. Let <span class="math inline">\(N\)</span> represent the total number of rows in the data, and let <span class="math inline">\(t\)</span> represent a chosen term. If a certain word were to appear in <strong>every</strong> single complaint, then we would have <span class="math inline">\(IDF(N, t) = log(\frac{N}{t}) = log(\frac{N}{N}) = log(1) = 0\)</span>, which would mean that when calculating <span class="math inline">\(TF-IDF\)</span>, that specific word would have absolutely no weight attached to it when classifying complaints.</p>
<p>Now; why do this? As discussed previously during the EDA section, almost 82% of all complaints fell into exactly three categories. Classification models will tend to stick to only a few categories, struggling to identify minor categories. While this may record higher accuracy scores on average, doing so means minor categories will rarely be classified at all, and in some instances, could lower overall accuracy if skew is significant enough. By ranking terms on an exponentially decreasing scale, we hope to reduce this issue.</p>
<p>We first setup our <code>TfidfVectorizer</code> and assign it to a variable, <code>tfidf</code>.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tfidf <span class="op">=</span> TfidfVectorizer(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  sublinear_tf <span class="op">=</span> <span class="va">True</span>, <span class="co"># Set term frequency to logarithmic scale</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  min_df <span class="op">=</span> <span class="dv">5</span>, <span class="co"># Remove terms that appear less than 'min_df' times</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  ngram_range <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">2</span>), <span class="co"># Unigrams and bigrams are considered </span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  stop_words <span class="op">=</span> <span class="st">'english'</span> <span class="co"># Use common English stop words</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>From here, we can begin building our models, but before doing so, let’s see what the most common terms were for each category.</p>
<p>To do so, we use <code>tfidf.get_feature_names_out()</code> on each category and assign that to a variable that we’ll call <strong>feature_names</strong>. This contains all of the most common words associated with each category, which we then split into two separate lists for unigrams and bigrams (fancy words for “one word” and “two words”). From there, we print to console the <span class="math inline">\(N = 3\)</span> most common terms from each list. We wrap all this in a <code>for</code> loop, automatically progressing through each category.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Defaults </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> tfidf.fit_transform(df.description).toarray()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> df.category_id</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># For Loop</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category, category_id <span class="kw">in</span> <span class="bu">sorted</span>(category_to_id.items()):</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  features_chi2 <span class="op">=</span> chi2(features, labels <span class="op">==</span> category_id)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  indices <span class="op">=</span> np.argsort(features_chi2[<span class="dv">0</span>])</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  feature_names <span class="op">=</span> np.array(tfidf.get_feature_names_out())[indices]</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  unigrams <span class="op">=</span> [v <span class="cf">for</span> v <span class="kw">in</span> feature_names <span class="cf">if</span> <span class="bu">len</span>(v.split(<span class="st">' '</span>)) <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  bigrams <span class="op">=</span> [v <span class="cf">for</span> v <span class="kw">in</span> feature_names <span class="cf">if</span> <span class="bu">len</span>(v.split(<span class="st">' '</span>)) <span class="op">==</span> <span class="dv">2</span>]</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">==&gt; </span><span class="sc">%s</span><span class="st">:"</span> <span class="op">%</span>(Product)) <span class="co"># Space for formatting</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"  * Most Correlated Unigrams are: </span><span class="sc">%s</span><span class="st">"</span> <span class="op">%</span>(<span class="st">', '</span>.join(unigrams[<span class="op">-</span>N:])))</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"  * Most Correlated Bigrams are: </span><span class="sc">%s</span><span class="st">"</span> <span class="op">%</span>(<span class="st">', '</span>.join(bigrams[<span class="op">-</span>N:])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As this part was performed offline, here is the output in screenshots.</p>
<p><img src="_images/term-correlation-1.png" class="img-fluid"></p>
<p><img src="_images/term-correlation-2.png" class="img-fluid"></p>
<p><img src="_images/term-correlation-3.png" class="img-fluid"></p>
<p>The results are largely what we would expect, though there are some things to note.</p>
<p>Some common phrases that appear for certain categories seemingly have nothing to do with them, such as the terms “77”, “kindly”, and “plz look”, which is one of the most common bigrams for both “Education” and “Welfare Schemes.” Remember, these were the categories that had less than 100 observations <strong>total</strong>. When we split the data to grab 15,000 random rows, these categories were split even further, which is probably why these nonsense phrases appear.</p>
</section>
<section id="building-the-models" class="level3">
<h3 class="anchored" data-anchor-id="building-the-models">Building the Models</h3>
<p>To begin, we first split the data into a 75:25 training and test split. The model will “learn” how to classify grievances based on the training data, and then it will “test” its accuracy on the remaining 25%.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We define them here as independent variables </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[<span class="st">"description"</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">"category"</span>]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size <span class="op">=</span> <span class="fl">0.25</span>, random_state <span class="op">=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>There are several different models to choose from, but it’s hard to know which will perform best before actually building them. That’s why we’ll test several models simultaneously by storing them in a list and looping through each model.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    RandomForestClassifier(n_estimators <span class="op">=</span> <span class="dv">100</span>, max_depth <span class="op">=</span> <span class="dv">5</span>, random_state <span class="op">=</span> <span class="dv">0</span>),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    LinearSVC(),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    MultinomialNB(),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    LogisticRegression(random_state <span class="op">=</span> <span class="dv">0</span>)    </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here, we stored in a list the following:</p>
<ul>
<li>Random Forest Model</li>
<li>Linear Support Vector Classifier Model</li>
<li>Multinomial Naive Bayes Model</li>
<li>Logistic Regression Model</li>
</ul>
<p>After, we apply each model to the training data and record the results. The accuracy of each model is inherently random, as model performance is somewhat due to chance, so we’ll use a five-fold cross-validation and take the mean average of each iteration to get a more balanced result. We store the results in a <code>pandas</code> dataframe for analysis.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy and pasted from before </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> tfidf.fit_transform(df.description).toarray()</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> df.category_id</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>CV <span class="op">=</span> <span class="dv">5</span> <span class="co"># Number of cross-validations</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>cv_df <span class="op">=</span> pd.DataFrame(index <span class="op">=</span> <span class="bu">range</span>(CV <span class="op">*</span> <span class="bu">len</span>(models))) <span class="co"># CV dataframe</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>entries <span class="op">=</span> [] <span class="co"># Array for storing model results </span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model <span class="kw">in</span> models:</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  model_name <span class="op">=</span> model.__class__.<span class="va">__name__</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  accuracies <span class="op">=</span> cross_val_score(model, features, labels, scoring<span class="op">=</span><span class="st">'accuracy'</span>, cv<span class="op">=</span>CV)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> fold_idx, accuracy <span class="kw">in</span> <span class="bu">enumerate</span>(accuracies):</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    entries.append((model_name, fold_idx, accuracy))</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>cv_df <span class="op">=</span> pd.DataFrame(entries, columns<span class="op">=</span>[<span class="st">'model_name'</span>, <span class="st">'fold_idx'</span>, <span class="st">'accuracy'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="results-1" class="level3">
<h3 class="anchored" data-anchor-id="results-1">Results</h3>
<p>Because we used a five-fold cross-validation, we have a total of 20 accuracy results - five for each model. We grab the mean accuracy and standard deviation for each model, storing them into a list.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>mean_accuracy <span class="op">=</span> cv_df.groupby(<span class="st">'model_name'</span>).accuracy.mean()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>std_accuracy <span class="op">=</span> cv_df.groupby(<span class="st">'model_name'</span>).accuracy.std()</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> pd.concat([mean_accuracy, std_accuracy], axis<span class="op">=</span> <span class="dv">1</span>, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>accuracy.columns <span class="op">=</span> [<span class="st">'Mean Accuracy'</span>, <span class="st">'Standard Deviation'</span>]</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<table class="table">
<thead>
<tr class="header">
<th>Model</th>
<th>Mean Accuracy</th>
<th>Standard Deviation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Linear SVC</td>
<td>88.773%</td>
<td>0.368%</td>
</tr>
<tr class="even">
<td>Logistic Regression</td>
<td>87.767%</td>
<td>0.433%</td>
</tr>
<tr class="odd">
<td>Multinomial NB</td>
<td>85.720%</td>
<td>0.117%</td>
</tr>
<tr class="even">
<td>Random Forest</td>
<td>66.213%</td>
<td>1.411%</td>
</tr>
</tbody>
</table>
<p>The top three models all performed similarly as well, all falling within 3.1% percentage points. The Linear Support Vector Classifier performed the best among the three, while the Random Forest performed atrociously. Standard deviation among the top three remained fairly low, but especially for multinomial naive bayes.</p>
</section>
</section>
<section id="improvements" class="level2">
<h2 class="anchored" data-anchor-id="improvements">Improvements</h2>
<p>We will focus model improvement on the Linear SVC because it performed the best.</p>
<p>As a reminder, these were the three main considerations before going in.</p>
<ol type="1">
<li>Account for imbalances in number of occurrences per category.</li>
<li>Consider reducing number of categories.</li>
<li>Consider adding additional stopwords.</li>
</ol>
<p>To get a better idea of how our model performed, we will plot a <strong>confusion matrix</strong>, which displays the total number of attempts our classification model made along with how many were accurately categorized.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recreating LinearSVC Model </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test,indices_train,indices_test <span class="op">=</span> train_test_split(features, </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                                                               labels, </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                                                               df.index, test_size<span class="op">=</span><span class="fl">0.25</span>, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                                                               random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LinearSVC()</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_test)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion Matrix Plot</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>conf_mat <span class="op">=</span> confusion_matrix(y_test, y_pred)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_mat, annot <span class="op">=</span> <span class="va">True</span>, cmap <span class="op">=</span> <span class="st">"Greens"</span>, fmt <span class="op">=</span> <span class="st">'d'</span>,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>            xticklabels <span class="op">=</span> category_id_df.category.values, </span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>            yticklabels <span class="op">=</span> category_id_df.category.values)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predicted"</span>)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Actual"</span>)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Confusion Matrix for LinearSVC </span><span class="ch">\n</span><span class="st">"</span>, size <span class="op">=</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<center>
<img src="_images/heatmap.png" class="img-fluid">
</center>
<p>On the diagonal are the number of rows that the model correctly predicted for each category. The horizontals and verticals represent the number of incorrect guesses, with the vertical representing incorrect guesses for that specific category. For example, the model correctly classified 1,484 complaints as “Electrical,” incorrectly classified 2 as “Electrical” when they should of been classified as “COVID-19,” and classified 10 as “Road Maintenance” when they should of been classified as “Electrical.”</p>
<section id="modifications" class="level3">
<h3 class="anchored" data-anchor-id="modifications">Modifications</h3>
<p>Looking at the chart, the top three categories dominate the total number of occurrences, comprising 2,969 rows out of 3,750 in our test data. Most of the incorrect predictions appear in the vertical of each of these three columns, meaning the model was incorrectly classifying complaints as them often. Even though we chose an algorithm to specifically downsample those categories, our model still has a tendency to over-predict them.</p>
<p>A few categories have 12 or fewer observations: those being Markets, Estate, OFC, Welfare Schemes, Advertisement, Education, Town Planning, Lakes, and Parks and Playgrounds. Converting these will likely improve accuracy considering how poorly our model did at predicting them, but there isn’t clear category to merge them with. Many of these categories seem to have been falsely labeled as “Road Maintenance.” While converting these columns over to this might lead to higher accuracy, it doesn’t really make any sense in this case, and likely would hurt performance in the future.</p>
<p>We could reassign these variables to “Others,” but that category performed <em>abysmally</em>, only correctly predicting 3 out of 43 complaints. On one hand, moving them there probably won’t hurt, but it likely won’t improve “Others” result either.</p>
<p>Lakes and Advertisements, which the model predicted quite a few correctly, will be left untouched for now. For the remaining categories under 12 test observations, they will be merged in with Others.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Data | Copy and Paste from Above</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"bengaluru-grievances.csv"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(df.category.unique()).values </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>character_limit <span class="op">=</span> (df[<span class="st">"description"</span>].<span class="bu">str</span>.<span class="bu">len</span>() <span class="op">&gt;</span> <span class="dv">12</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.loc[character_limit]</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sample(<span class="dv">15000</span>, random_state <span class="op">=</span> <span class="dv">2</span>).copy() <span class="co"># Select New Rows </span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Columns </span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"category"</span>] <span class="op">=</span> df[<span class="st">"category"</span>].replace({<span class="st">'Markets'</span>: <span class="st">'Others'</span>})</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"category"</span>] <span class="op">=</span> df[<span class="st">"category"</span>].replace({<span class="st">'Estate'</span>: <span class="st">'Others'</span>})</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"category"</span>] <span class="op">=</span> df[<span class="st">"category"</span>].replace({<span class="st">'Welfare Schemes'</span>: <span class="st">'Others'</span>})</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"category"</span>] <span class="op">=</span> df[<span class="st">"category"</span>].replace({<span class="st">'Education'</span>: <span class="st">'Others'</span>})</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"category"</span>] <span class="op">=</span> df[<span class="st">"category"</span>].replace({<span class="st">'Town Planning'</span>: <span class="st">'Others'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>“Optical Fiber Cables” and “Storm Water Drains,” though, are directly related to “Road Maintenance,” and if we look at the chart, that’s what the model ended up incorrectly guessing the most of. For these categories, it makes more sense to convert them over to “Road Maintenance” as opposed to “Others.”</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"category"</span>] <span class="op">=</span> df[<span class="st">"category"</span>].replace({<span class="st">'Optical Fiber Cables (OFC)'</span>: <span class="st">'Road Maintenance(Engg)'</span>})</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"category"</span>] <span class="op">=</span> df[<span class="st">"category"</span>].replace({<span class="st">'Storm  Water Drain(SWD)'</span>: <span class="st">'Road Maintenance(Engg)'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>While we’ve converted the total number of categories down from 20 to 13, we’ve only changed a total of 45 test rows. Even if the improved model were able to correctly predict all these observations now, we would only see an improvement of 1.2%. It’s certainly not insignificant, but hardly substantial. Improving our stop word list, on the other hand, will hypothetically improve the accuracy of the model overall.</p>
<p>Recall earlier when we found the most common unigrams and bigrams for each category. Several terms that appeared most often had little or nothing to do with their respective grievances, and should be able to be removed while maintaining or improving original accuracy.</p>
<p>The original stop word list comes from another function in <code>sklearn</code>, and already contains over 300 words. We want to keep those words while adding to it, so we will union them together in a new list and use it in <code>TfidfVectorizer</code>.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Function </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction <span class="im">import</span> text</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Stop Words </span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>stop_words <span class="op">=</span> text.ENGLISH_STOP_WORDS.union([<span class="st">"please"</span>, <span class="st">"plz"</span>, <span class="st">"look"</span>, <span class="st">"help"</span>, <span class="st">"causing"</span>, <span class="st">"coming"</span>, <span class="st">"kindly"</span>, <span class="st">"refused"</span>, <span class="st">"senior"</span>, <span class="st">"help"</span>, <span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span>, <span class="st">"also"</span>, <span class="st">"77"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"since"</span>])</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># TfidfVectorizer </span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>tfidf <span class="op">=</span> TfidfVectorizer(</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  sublinear_tf <span class="op">=</span> <span class="va">True</span>, <span class="co"># Set term frequency to logarithmic scale</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  min_df <span class="op">=</span> <span class="dv">5</span>, <span class="co"># Remove terms that appear less than 'min_df' times</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  ngram_range <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">2</span>), <span class="co"># Keep unigrams and bigrams</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  stop_words <span class="op">=</span> stop_words <span class="co"># Use custom stop words </span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="redo-text-preprocessing" class="level3">
<h3 class="anchored" data-anchor-id="redo-text-preprocessing">Redo Text Preprocessing</h3>
<p>We have to redo the text preprocessing from earlier, so this is all copy-and-paste from before.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy and Paste</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'category_id'</span>] <span class="op">=</span> df[<span class="st">"category"</span>].factorize()[<span class="dv">0</span>]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>category_id_df <span class="op">=</span> df[[<span class="st">"category"</span>, <span class="st">"category_id"</span>]].drop_duplicates()</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>category_to_id <span class="op">=</span> <span class="bu">dict</span>(category_id_df.values)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>id_to_category <span class="op">=</span> <span class="bu">dict</span>(category_id_df[[<span class="st">"category_id"</span>, <span class="st">"category"</span>]].values)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> tfidf.fit_transform(df.description).toarray()</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> df.category_id</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[<span class="st">"description"</span>]</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">"category"</span>]</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test,indices_train,indices_test <span class="op">=</span> train_test_split(</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  features, </span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  labels, </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  df.index, test_size <span class="op">=</span> <span class="fl">0.25</span>, </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  random_state <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LinearSVC()</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="new-results" class="level3">
<h3 class="anchored" data-anchor-id="new-results">New Results</h3>
<p>We don’t need the complicated <code>for</code> loop from before because we only have one model this time. Therefore, we simply use <code>cross_val_score</code> as we did before and print the results to console.</p>
<div class="cell">
<details>
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>accuracy_svc <span class="op">=</span> cross_val_score(model, features, labels, scoring<span class="op">=</span><span class="st">'accuracy'</span>, cv<span class="op">=</span>CV)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>cv_mean_accuracy_svc <span class="op">=</span> accuracy_svc.mean()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>cv_mean_std_svc <span class="op">=</span> accuracy_svc.std()</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cv_mean_accuracy_svc <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cv_mean_std_svc <span class="op">*</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<center>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="_images/results.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Results</figcaption><p></p>
</figure>
</div>
</center>
<p>Our new Linear SVC model was able to achieve <strong>91.987%</strong> accuracy with an average standard deviation of <em>0.282%</em> across five iterations. That’s an improvement of <strong>3.214%</strong> while also reducing variance within model performance by <em>0.086%</em>.</p>
<p>Another way to look at these refinements; out of a possible <strong>3,750</strong> complaints, our model was able to correctly classify an additional <em>120</em> complaints, going from <strong>3,328</strong> correct predictions to <strong>3,449</strong>.</p>
<center>
<img src="_images/heatmap-2.png" class="img-fluid">
</center>
</section>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>Once again, the top three categories performed similarly as well as before. Road maintenance was able to correctly predict an additional <em>63</em> complaints on this iteration. These three categories also continue to make up most of the incorrect predictions.</p>
<p>The “Others” categories once again performed dreadfully, only recording an additional two correct predictions despite even more chances. Given it’s a category meant to be all-emcompassing, it probably makes sense to manually reclassify those comaplaints into new or existing categories.</p>
<p>Minor categories saw little or no improvement. The “Health Dept” was the only category that performed worse, dropping from 69.7% to 54.6% accuracy. The model incorrectly chose “Solid Waste” and “Road Maintenance” much more often than the previous model did, though it’s unclear as to why this is.</p>
<p>Increasing the stop word list seems to have improved accuracy overall. A more thorough list and additional adjustments might boost performance slightly more.</p>
</section>
<section id="source" class="level2">
<h2 class="anchored" data-anchor-id="source">Source</h2>
<p>You can check out the Python source code for the MLE model <a href="https://github.com/Nathan-States/Bengaluru-Text-Mining">here</a>. Download the full dataset <a href="https://www.dolthub.com/repositories/bkowshik/bbmp-sahaaya">here</a>.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp(/https:\/\/nathanstates\.com/);
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb30" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Bengaluru Text Mining"</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> 'Analyzing over 100,000 complaints from the Silicon Valley of India.'</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Nathan States"</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "01/22/2023"</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [text_mining, machine_learning]</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show code"</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: right</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="al">![Aerial view of *Bengaluru*, India.](_images/preview.jpg)</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results </span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Over **80%** of complaints filed were related to street lights not working, road maintenance, or garbage collection issues. </span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Of the four classification models, the linear support vector classifier performed the best, recording **88.773%** accuracy. The top three models all performed similarly as well, though, all falling within three percentage points.</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Improvements were made by increasing the number of stop words, as well as combining smaller categories into larger ones. Using LinearSVC, these changes led to a 3.214% increase, ultimately recording an accuracy of **91.987%**. </span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Further improvements can be made by adding to the stop word list, changing the contents of the "Others" category, and adjusting the downsampling of the model. </span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="fu">## Background</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>Text data can be difficult to analyze in large amounts, but raw text is invaluable in numerous different ways. Using simple Python libraries, modern machine learning models can parse thousands of rows in seconds, which can be used for a variety of purposes. One of the most common of these is *classification*, or categorizing text into different groups.  </span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>The *Bruhat Bengaluru Mahangara Palike* (BBMP) - an administrative body that oversees city development in Bengaluru, the largest tech city in India - created a web application that allows citizens to file grievances with the city. From February 8th, 2020 to February 21st, 2021, a total of **105,956** complaints were filed to BBMP, or about 280 a day. Exploring this data not only provides insight into the most common problems facing this city (or at least the complaints most likely to be sent), but also presents an opportunity to quantify and categorize them. </span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>In the dataset, complaints have been manually categorized by the administrators who oversee the app at BBMP, but this is extremely inefficient. Usefully, though, the developers have already created categories that they felt best sorted the data, which means, assuming complaints don't change substantially in the future, we can train a machine learning model that performs this task automatically. This could save hours and hours of time.</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>Because the categories are already defined, this will be a **supervised** classification model. </span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Wrangling</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>Data wrangling and EDA done using <span class="in">`R`</span>. </span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>First, we import the data and the libraries we will be using. </span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=TRUE, message=FALSE, warning=FALSE}</span></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Libraries</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(echarts4r)</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wordcloud2)</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Set Directory </span></span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">set_here</span>()</span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Data</span></span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a>grievances <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"bengaluru-grievances.csv"</span>)</span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>The admins at BBMP keep their data neat and tidy, so there's not many problems to fix. There are a couple things to consider, however. </span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a>The first issue is that some descriptions are extremely short, making classifying them accurately near impossible. We can limit the number of characters that a complaint must have, though the appropriate number of rows to remove is debatable. Ideally, we don't want to exclude too much of the data while still removing descriptions too short to be properly categorized. </span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a>Using <span class="in">`str_length`</span> from the <span class="in">`stringr`</span> package, we see 5,392 complaints contained fewer than 12 characters, meaning removing them would still preserve 95% of the original data. Using <span class="in">`filter`</span> from <span class="in">`dplyr`</span>, we can keep all complaints containing more than 12 characters. </span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE, message=FALSE, warning=FALSE}</span></span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Counting number of rows </span></span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a>grievances <span class="sc">%&gt;%</span></span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_length</span>(description) <span class="sc">&lt;</span> <span class="dv">12</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() </span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE, message=FALSE, warning=FALSE}</span></span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing those rows </span></span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a>grievances <span class="ot">&lt;-</span> grievances <span class="sc">%&gt;%</span></span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_length</span>(description) <span class="sc">&gt;</span> <span class="dv">12</span>)</span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-79"><a href="#cb30-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-80"><a href="#cb30-80" aria-hidden="true" tabindex="-1"></a>The other consideration is whether the existing categories accurately reflect the data or not. It's possible certain similarities between different categories would better be combined into one, and likewise, single categories that should be multiple ones. These changes might not only provide a better description of the data, but improve accuracy in the long run. </span>
<span id="cb30-81"><a href="#cb30-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-82"><a href="#cb30-82" aria-hidden="true" tabindex="-1"></a>For now, we will leave the original categories intact and proceed, but future models may benefit from this step.  </span>
<span id="cb30-83"><a href="#cb30-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-84"><a href="#cb30-84" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exploratory Data Analysis  </span></span>
<span id="cb30-85"><a href="#cb30-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-86"><a href="#cb30-86" aria-hidden="true" tabindex="-1"></a>Interactive charts created using <span class="in">`echarts4r`</span>. </span>
<span id="cb30-87"><a href="#cb30-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-88"><a href="#cb30-88" aria-hidden="true" tabindex="-1"></a><span class="fu">### Number of Grievances By Day </span></span>
<span id="cb30-89"><a href="#cb30-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-90"><a href="#cb30-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE, message=FALSE, warning=FALSE}</span></span>
<span id="cb30-91"><a href="#cb30-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Set Theme </span></span>
<span id="cb30-92"><a href="#cb30-92" aria-hidden="true" tabindex="-1"></a><span class="fu">e_common</span>(</span>
<span id="cb30-93"><a href="#cb30-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">font_family =</span> <span class="st">"Georgia"</span></span>
<span id="cb30-94"><a href="#cb30-94" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-95"><a href="#cb30-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-96"><a href="#cb30-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Chart </span></span>
<span id="cb30-97"><a href="#cb30-97" aria-hidden="true" tabindex="-1"></a>grievances <span class="sc">%&gt;%</span></span>
<span id="cb30-98"><a href="#cb30-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">created_at =</span> <span class="fu">as.Date</span>(created_at)) <span class="sc">%&gt;%</span></span>
<span id="cb30-99"><a href="#cb30-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb30-100"><a href="#cb30-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_charts</span>(created_at) <span class="sc">%&gt;%</span></span>
<span id="cb30-101"><a href="#cb30-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_line</span>(Total, <span class="at">symbol =</span> <span class="st">"none"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-102"><a href="#cb30-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_x_axis</span>(<span class="at">axisLabel =</span> <span class="fu">list</span>(<span class="at">interval =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-103"><a href="#cb30-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_title</span>(</span>
<span id="cb30-104"><a href="#cb30-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="st">"Total number of grievances by day"</span>,</span>
<span id="cb30-105"><a href="#cb30-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtext =</span> <span class="st">"Data: BBMP"</span></span>
<span id="cb30-106"><a href="#cb30-106" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-107"><a href="#cb30-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_color</span>(</span>
<span id="cb30-108"><a href="#cb30-108" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#0a32d2"</span>, </span>
<span id="cb30-109"><a href="#cb30-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">background =</span> <span class="st">"rgb(0, 0, 0, 0)"</span></span>
<span id="cb30-110"><a href="#cb30-110" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-111"><a href="#cb30-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_legend</span>(<span class="at">show =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-112"><a href="#cb30-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_tooltip</span>(</span>
<span id="cb30-113"><a href="#cb30-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">backgroundColor =</span> <span class="st">"rgba(20, 20, 20, 0.5)"</span>,</span>
<span id="cb30-114"><a href="#cb30-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">borderColor =</span> <span class="st">"rgba(0, 0, 0, 0)"</span>,</span>
<span id="cb30-115"><a href="#cb30-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">textStyle =</span> <span class="fu">list</span>(</span>
<span id="cb30-116"><a href="#cb30-116" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"#ffffff"</span></span>
<span id="cb30-117"><a href="#cb30-117" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb30-118"><a href="#cb30-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">trigger =</span> <span class="st">"axis"</span></span>
<span id="cb30-119"><a href="#cb30-119" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-120"><a href="#cb30-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-121"><a href="#cb30-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-122"><a href="#cb30-122" aria-hidden="true" tabindex="-1"></a>On most days, grievances would vary between 200 to 400 a day, with some spikes in September onwards, including a massive single-day one in March of 742. On average, 280 complaints were filed each day. </span>
<span id="cb30-123"><a href="#cb30-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-124"><a href="#cb30-124" aria-hidden="true" tabindex="-1"></a>Because complaints don't seem to fluctuate significantly, we can likely assume that the day the grievance was filed isn't indicative of its contents.  </span>
<span id="cb30-125"><a href="#cb30-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-126"><a href="#cb30-126" aria-hidden="true" tabindex="-1"></a><span class="fu">### Grievances by Category</span></span>
<span id="cb30-127"><a href="#cb30-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-128"><a href="#cb30-128" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE}</span></span>
<span id="cb30-129"><a href="#cb30-129" aria-hidden="true" tabindex="-1"></a>grievances <span class="sc">%&gt;%</span></span>
<span id="cb30-130"><a href="#cb30-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(category) <span class="sc">%&gt;%</span></span>
<span id="cb30-131"><a href="#cb30-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb30-132"><a href="#cb30-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Total)) <span class="sc">%&gt;%</span></span>
<span id="cb30-133"><a href="#cb30-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Total <span class="sc">&gt;</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-134"><a href="#cb30-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-135"><a href="#cb30-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_charts</span>(category) <span class="sc">%&gt;%</span></span>
<span id="cb30-136"><a href="#cb30-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_bar</span>(Total) <span class="sc">%&gt;%</span></span>
<span id="cb30-137"><a href="#cb30-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_x_axis</span>(</span>
<span id="cb30-138"><a href="#cb30-138" aria-hidden="true" tabindex="-1"></a>    <span class="at">axisLabel =</span> <span class="fu">list</span>(</span>
<span id="cb30-139"><a href="#cb30-139" aria-hidden="true" tabindex="-1"></a>      <span class="at">interval =</span> <span class="dv">0</span>, </span>
<span id="cb30-140"><a href="#cb30-140" aria-hidden="true" tabindex="-1"></a>      <span class="at">rotate =</span> <span class="dv">45</span>,</span>
<span id="cb30-141"><a href="#cb30-141" aria-hidden="true" tabindex="-1"></a>      <span class="at">fontSize =</span> <span class="fl">9.25</span></span>
<span id="cb30-142"><a href="#cb30-142" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-143"><a href="#cb30-143" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-144"><a href="#cb30-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_title</span>(</span>
<span id="cb30-145"><a href="#cb30-145" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="st">"Most common grievances by category"</span>, </span>
<span id="cb30-146"><a href="#cb30-146" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtext =</span> <span class="st">"Only categories above 1,000 visible"</span></span>
<span id="cb30-147"><a href="#cb30-147" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-148"><a href="#cb30-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_legend</span>(<span class="at">show =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-149"><a href="#cb30-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_labels</span>(<span class="at">show =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-150"><a href="#cb30-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_color</span>(</span>
<span id="cb30-151"><a href="#cb30-151" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#8c5ac8"</span>, </span>
<span id="cb30-152"><a href="#cb30-152" aria-hidden="true" tabindex="-1"></a>    <span class="at">background =</span> <span class="st">"rgb(0, 0, 0, 0)"</span></span>
<span id="cb30-153"><a href="#cb30-153" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-154"><a href="#cb30-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_tooltip</span>(</span>
<span id="cb30-155"><a href="#cb30-155" aria-hidden="true" tabindex="-1"></a>    <span class="at">trigger =</span> <span class="st">"axis"</span>,</span>
<span id="cb30-156"><a href="#cb30-156" aria-hidden="true" tabindex="-1"></a>    <span class="at">backgroundColor =</span> <span class="st">"rgba(20, 20, 20, 0.5)"</span>,</span>
<span id="cb30-157"><a href="#cb30-157" aria-hidden="true" tabindex="-1"></a>    <span class="at">borderColor =</span> <span class="st">"rgba(0, 0, 0, 0)"</span>,</span>
<span id="cb30-158"><a href="#cb30-158" aria-hidden="true" tabindex="-1"></a>    <span class="at">textStyle =</span> <span class="fu">list</span>(</span>
<span id="cb30-159"><a href="#cb30-159" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"#ffffff"</span></span>
<span id="cb30-160"><a href="#cb30-160" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-161"><a href="#cb30-161" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-162"><a href="#cb30-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-163"><a href="#cb30-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-164"><a href="#cb30-164" aria-hidden="true" tabindex="-1"></a>81.89% of total grievances were categorized as electrical, solid waste or garbage related, or road maintenance. The next three largest categories make up an additional 11.09%, meaning the remaining categories have less than 1,350 occurrences combined. </span>
<span id="cb30-165"><a href="#cb30-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-166"><a href="#cb30-166" aria-hidden="true" tabindex="-1"></a>Note that this is *not* due to a lack of categories; in fact, there are a total of 20 categories in the data. </span>
<span id="cb30-167"><a href="#cb30-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-170"><a href="#cb30-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-171"><a href="#cb30-171" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(grievances<span class="sc">$</span>category))</span>
<span id="cb30-172"><a href="#cb30-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-173"><a href="#cb30-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-174"><a href="#cb30-174" aria-hidden="true" tabindex="-1"></a>Large imbalances like this are important to consider when building machine learning models. Algorithms are specifically programmed to achieve the highest accuracy regardless of original purposes, and they tend to overestimate larger categories. If a model discovers it can restrict itself to three options while still recording 80%+ accuracy, it will almost always do so. </span>
<span id="cb30-175"><a href="#cb30-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-176"><a href="#cb30-176" aria-hidden="true" tabindex="-1"></a>This means, though, machine learning models will tend to ignore minor categories, because - using our current data as an example - predicting a category outside the top three has an inherent 81.89% *fail* rate, so this will need to be addressed when creating the models. </span>
<span id="cb30-177"><a href="#cb30-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-178"><a href="#cb30-178" aria-hidden="true" tabindex="-1"></a>There is a question as to whether certain smaller categories should exist at **all**, though. </span>
<span id="cb30-179"><a href="#cb30-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-182"><a href="#cb30-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-183"><a href="#cb30-183" aria-hidden="true" tabindex="-1"></a>grievances <span class="sc">%&gt;%</span></span>
<span id="cb30-184"><a href="#cb30-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(category) <span class="sc">%&gt;%</span></span>
<span id="cb30-185"><a href="#cb30-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb30-186"><a href="#cb30-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(total <span class="sc">&lt;</span> <span class="dv">100</span>)</span>
<span id="cb30-187"><a href="#cb30-187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-188"><a href="#cb30-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-189"><a href="#cb30-189" aria-hidden="true" tabindex="-1"></a>Five categories have less than 100 complaints total, including two which have less than thirty. This is far too few complaints to reliably build a model with, especially considering we haven't split the data yet.</span>
<span id="cb30-190"><a href="#cb30-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-191"><a href="#cb30-191" aria-hidden="true" tabindex="-1"></a><span class="fu">### Grievances by Subcategory </span></span>
<span id="cb30-192"><a href="#cb30-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-195"><a href="#cb30-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-196"><a href="#cb30-196" aria-hidden="true" tabindex="-1"></a>grievances <span class="sc">%&gt;%</span></span>
<span id="cb30-197"><a href="#cb30-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subcategory) <span class="sc">%&gt;%</span></span>
<span id="cb30-198"><a href="#cb30-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb30-199"><a href="#cb30-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Total) <span class="sc">%&gt;%</span></span>
<span id="cb30-200"><a href="#cb30-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Total <span class="sc">&gt;</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-201"><a href="#cb30-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_charts</span>(subcategory) <span class="sc">%&gt;%</span></span>
<span id="cb30-202"><a href="#cb30-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_bar</span>(Total) <span class="sc">%&gt;%</span></span>
<span id="cb30-203"><a href="#cb30-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_legend</span>(<span class="at">show =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-204"><a href="#cb30-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_title</span>(</span>
<span id="cb30-205"><a href="#cb30-205" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="st">"Most common grievances by subcategory"</span>, </span>
<span id="cb30-206"><a href="#cb30-206" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtext =</span> <span class="st">"Only categories above 1,000 visible"</span></span>
<span id="cb30-207"><a href="#cb30-207" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb30-208"><a href="#cb30-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_color</span>(<span class="st">"#8c5ac8"</span>, <span class="at">background =</span> <span class="st">"rgb(0,0,0,0)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-209"><a href="#cb30-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_flip_coords</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-210"><a href="#cb30-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">e_tooltip</span>(</span>
<span id="cb30-211"><a href="#cb30-211" aria-hidden="true" tabindex="-1"></a>    <span class="at">trigger =</span> <span class="st">"axis"</span>,</span>
<span id="cb30-212"><a href="#cb30-212" aria-hidden="true" tabindex="-1"></a>    <span class="at">backgroundColor =</span> <span class="st">"rgba(20, 20, 20, 0.5)"</span>,</span>
<span id="cb30-213"><a href="#cb30-213" aria-hidden="true" tabindex="-1"></a>    <span class="at">borderColor =</span> <span class="st">"rgba(0, 0, 0, 0)"</span>,</span>
<span id="cb30-214"><a href="#cb30-214" aria-hidden="true" tabindex="-1"></a>    <span class="at">textStyle =</span> <span class="fu">list</span>(</span>
<span id="cb30-215"><a href="#cb30-215" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"#ffffff"</span></span>
<span id="cb30-216"><a href="#cb30-216" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-217"><a href="#cb30-217" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-218"><a href="#cb30-218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-219"><a href="#cb30-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-220"><a href="#cb30-220" aria-hidden="true" tabindex="-1"></a>While the model being built is only to predict the main categories, by viewing subcategories, we see over 35% of total complaints were related specifically to street lights not working, comprising almost all of the electrical category. Solid waste related problems is divided into two subcategories; garbage vehicle not arriving, and "Garbage dump" (whatever that means). Meanwhile, road maintenance has been divided into three subcategories, those being potholes, road side drains, and debris removal.</span>
<span id="cb30-221"><a href="#cb30-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-222"><a href="#cb30-222" aria-hidden="true" tabindex="-1"></a><span class="fu">### Most Common Complaint Words </span></span>
<span id="cb30-223"><a href="#cb30-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-224"><a href="#cb30-224" aria-hidden="true" tabindex="-1"></a>We first have to get the 50 most common words...</span>
<span id="cb30-225"><a href="#cb30-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-226"><a href="#cb30-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb30-227"><a href="#cb30-227" aria-hidden="true" tabindex="-1"></a>tidy <span class="ot">&lt;-</span> grievances <span class="sc">%&gt;%</span></span>
<span id="cb30-228"><a href="#cb30-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, description) <span class="sc">%&gt;%</span></span>
<span id="cb30-229"><a href="#cb30-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(<span class="fu">get_stopwords</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb30-230"><a href="#cb30-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word) <span class="sc">%&gt;%</span></span>
<span id="cb30-231"><a href="#cb30-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb30-232"><a href="#cb30-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)</span>
<span id="cb30-233"><a href="#cb30-233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-234"><a href="#cb30-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-235"><a href="#cb30-235" aria-hidden="true" tabindex="-1"></a>Then chart them using <span class="in">`wordcloud2`</span>. </span>
<span id="cb30-236"><a href="#cb30-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-239"><a href="#cb30-239" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-240"><a href="#cb30-240" aria-hidden="true" tabindex="-1"></a><span class="fu">wordcloud2</span>(</span>
<span id="cb30-241"><a href="#cb30-241" aria-hidden="true" tabindex="-1"></a>  tidy,</span>
<span id="cb30-242"><a href="#cb30-242" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">rep_len</span>(<span class="fu">c</span>(<span class="st">"#8c5ac8"</span>, <span class="st">"#0b0d21"</span>, <span class="st">"#0a32d2"</span>), <span class="fu">nrow</span>(tidy)),</span>
<span id="cb30-243"><a href="#cb30-243" aria-hidden="true" tabindex="-1"></a>  <span class="at">backgroundColor =</span> <span class="st">"#fcfcfc"</span></span>
<span id="cb30-244"><a href="#cb30-244" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-245"><a href="#cb30-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-246"><a href="#cb30-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-247"><a href="#cb30-247" aria-hidden="true" tabindex="-1"></a>Seeing as over a third of the data was subcategorized as street lights not working, we see that they are the most common words across all the complaints.</span>
<span id="cb30-248"><a href="#cb30-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-249"><a href="#cb30-249" aria-hidden="true" tabindex="-1"></a>Missing from that is the word *not*, but this is because we removed all **stop words** from the data. Put simply, stop words are words that don't add anything to the process of categorizing text. They usually include words like *he*, *she*, *there*, *they*, *I*, and so on, which is why they don't appear in the chart. </span>
<span id="cb30-250"><a href="#cb30-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-251"><a href="#cb30-251" aria-hidden="true" tabindex="-1"></a>The stop words included in the <span class="in">`tidytext`</span> package (and the ones used in the function above) are meant to apply universally, but if you look closely at the word cloud, there are several words that almost certainly don't apply to our problem. These include terms like *please*, *kindly*, *last request*, *sir*, and individual numbers like *1*, *2*, and *3*. While there might exist some incidental correlation between some of these words and their respective categories (perhaps citizens filing animal control complaints are nicer on average, so the term *please* could be used to identify those complaints more accurately, for example), it's likely this will just throw off our model's accuracy in the long run. </span>
<span id="cb30-252"><a href="#cb30-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-253"><a href="#cb30-253" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb30-254"><a href="#cb30-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-255"><a href="#cb30-255" aria-hidden="true" tabindex="-1"></a>From the EDA, the primary factors that should be considered when building the models are: </span>
<span id="cb30-256"><a href="#cb30-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-257"><a href="#cb30-257" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Account for imbalances in number of occurrences per category. </span>
<span id="cb30-258"><a href="#cb30-258" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Reduce the number of categories by combining them into existing ones. </span>
<span id="cb30-259"><a href="#cb30-259" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Add additional stop words. </span>
<span id="cb30-260"><a href="#cb30-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-261"><a href="#cb30-261" aria-hidden="true" tabindex="-1"></a><span class="fu">## MLE Models </span></span>
<span id="cb30-262"><a href="#cb30-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-263"><a href="#cb30-263" aria-hidden="true" tabindex="-1"></a><span class="fu">### Preparing the Data </span></span>
<span id="cb30-264"><a href="#cb30-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-265"><a href="#cb30-265" aria-hidden="true" tabindex="-1"></a>We'll opt to use Python for creating the MLE models, as Python libraries are generally more efficient and developed than their R counterparts. Because creating models is computer intensive, the code here has been evaluated locally and presented here for demonstration.</span>
<span id="cb30-266"><a href="#cb30-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-267"><a href="#cb30-267" aria-hidden="true" tabindex="-1"></a>To start, we'll import the necessary libraries and load the data using <span class="in">`pandas`</span>. The models here will be built using <span class="in">`sklearn`</span>. </span>
<span id="cb30-268"><a href="#cb30-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-269"><a href="#cb30-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE, warning=FALSE}</span></span>
<span id="cb30-270"><a href="#cb30-270" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb30-271"><a href="#cb30-271" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb30-272"><a href="#cb30-272" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb30-273"><a href="#cb30-273" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns  </span>
<span id="cb30-274"><a href="#cb30-274" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb30-275"><a href="#cb30-275" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> chi2</span>
<span id="cb30-276"><a href="#cb30-276" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb30-277"><a href="#cb30-277" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> MultinomialNB</span>
<span id="cb30-278"><a href="#cb30-278" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb30-279"><a href="#cb30-279" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb30-280"><a href="#cb30-280" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> LinearSVC</span>
<span id="cb30-281"><a href="#cb30-281" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb30-282"><a href="#cb30-282" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb30-283"><a href="#cb30-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-284"><a href="#cb30-284" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"bengaluru-grievances.csv"</span>)</span>
<span id="cb30-285"><a href="#cb30-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-286"><a href="#cb30-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-287"><a href="#cb30-287" aria-hidden="true" tabindex="-1"></a>One of the packages imported here is <span class="in">`TfidfVectorizer`</span>, which will be the algorithm used to create the models. I'll explain why I specifically chose this package later on. </span>
<span id="cb30-288"><a href="#cb30-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-289"><a href="#cb30-289" aria-hidden="true" tabindex="-1"></a>Here, I quickly apply the earlier data wrangling techniques by removing complaints less than 12 characters, this time using Python syntax. </span>
<span id="cb30-290"><a href="#cb30-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-291"><a href="#cb30-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE, warning=FALSE}</span></span>
<span id="cb30-292"><a href="#cb30-292" aria-hidden="true" tabindex="-1"></a><span class="co"># Reduce Character Limit  </span></span>
<span id="cb30-293"><a href="#cb30-293" aria-hidden="true" tabindex="-1"></a>character_limit <span class="op">=</span> (df[<span class="st">"description"</span>].<span class="bu">str</span>.<span class="bu">len</span>() <span class="op">&gt;</span> <span class="dv">12</span>)</span>
<span id="cb30-294"><a href="#cb30-294" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.loc[character_limit]</span>
<span id="cb30-295"><a href="#cb30-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-296"><a href="#cb30-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-297"><a href="#cb30-297" aria-hidden="true" tabindex="-1"></a>A model based on over 100,000 observations is **extremely** hardware intensive, and it causes my laptop to overheat a lot. For practical purposes, we'll cut down on our data by choosing 15,000 rows at random. </span>
<span id="cb30-298"><a href="#cb30-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-299"><a href="#cb30-299" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE, warning=FALSE}</span></span>
<span id="cb30-300"><a href="#cb30-300" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sample(<span class="dv">15000</span>, random_state <span class="op">=</span> <span class="dv">1</span>).copy()</span>
<span id="cb30-301"><a href="#cb30-301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-302"><a href="#cb30-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-303"><a href="#cb30-303" aria-hidden="true" tabindex="-1"></a>If we wanted to get another random 15,000 rows, we could change the <span class="in">`random_state = 1`</span> argument to any other number, like 42, 671, or 7. </span>
<span id="cb30-304"><a href="#cb30-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-305"><a href="#cb30-305" aria-hidden="true" tabindex="-1"></a>With no other changes to be made, we can begin creating the models. </span>
<span id="cb30-306"><a href="#cb30-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-307"><a href="#cb30-307" aria-hidden="true" tabindex="-1"></a><span class="fu">### Text Preprocessing </span></span>
<span id="cb30-308"><a href="#cb30-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-309"><a href="#cb30-309" aria-hidden="true" tabindex="-1"></a>There are several methods to building models, but the simplest method is to create a new column in our data - we'll call it **category_id** - that is a factor variable of all existing categories in our data. This essentially amounts to assigning each category a number (Electrical = 0, Road Engineering = 1, etc), which is necessary for getting our model to run properly, as <span class="in">`sklearn`</span> will not understand strings as factors.   </span>
<span id="cb30-310"><a href="#cb30-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-311"><a href="#cb30-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE, warning=FALSE}</span></span>
<span id="cb30-312"><a href="#cb30-312" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'category_id'</span>] <span class="op">=</span> df[<span class="st">"category"</span>].factorize()[<span class="dv">0</span>]</span>
<span id="cb30-313"><a href="#cb30-313" aria-hidden="true" tabindex="-1"></a>category_id_df <span class="op">=</span> df[[<span class="st">"category"</span>, <span class="st">"category_id"</span>]].drop_duplicates()</span>
<span id="cb30-314"><a href="#cb30-314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-315"><a href="#cb30-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-316"><a href="#cb30-316" aria-hidden="true" tabindex="-1"></a>Next, the description column (which stores the text for grievances) needs to be converted to vectors using a chosen algorithm. The algorithm chosen here is **Term Frequency - Inverse Document Frequency** (TF-IDF), which is the product of $TF$ and $IDF$ scores. This is the <span class="in">`TfidfVectorizer`</span> function that we imported earlier. </span>
<span id="cb30-317"><a href="#cb30-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-318"><a href="#cb30-318" aria-hidden="true" tabindex="-1"></a>It's useful to present these terms mathematically.</span>
<span id="cb30-319"><a href="#cb30-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-320"><a href="#cb30-320" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb30-321"><a href="#cb30-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-322"><a href="#cb30-322" aria-hidden="true" tabindex="-1"></a>**Term Frequency**: $$ TF = \frac{Number \hspace{0.15cm} of \hspace{0.15cm} times \hspace{0.15cm} a \hspace{0.15cm} term \hspace{0.15cm} appears \hspace{0.15cm} in \hspace{0.15cm} the \hspace{0.15cm} description}{Total \hspace{0.15cm} number \hspace{0.15cm} of \hspace{0.15cm} words \hspace{0.15cm} in \hspace{0.15cm} the \hspace{0.15cm} description} $$</span>
<span id="cb30-323"><a href="#cb30-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-324"><a href="#cb30-324" aria-hidden="true" tabindex="-1"></a>**Inverse Document Frequency**: $$ IDF = log(\frac{Number \hspace{0.15cm} of \hspace{0.15cm} rows \hspace{0.15cm} in \hspace{0.15cm} a \hspace{0.15cm} data}{Number \hspace{0.15cm} of \hspace{0.15cm} rows \hspace{0.15cm} a \hspace{0.15cm} term \hspace{0.15cm} appears \hspace{0.15cm} in \hspace{0.15cm} a \hspace{0.15cm} data}) $$</span>
<span id="cb30-325"><a href="#cb30-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-326"><a href="#cb30-326" aria-hidden="true" tabindex="-1"></a>**TF-IDF**: $$ TF-IDF = TF * IDF $$</span>
<span id="cb30-327"><a href="#cb30-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-328"><a href="#cb30-328" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb30-329"><a href="#cb30-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-330"><a href="#cb30-330" aria-hidden="true" tabindex="-1"></a>The reason for choosing this algorithm was for the $IDF$ component, which **downsamples** words that appear frequently across all complaints, while adding extra weight to terms that appear less often. </span>
<span id="cb30-331"><a href="#cb30-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-332"><a href="#cb30-332" aria-hidden="true" tabindex="-1"></a>Analyzing it mathematically: as the denominator of the $IDF$ variable increases, the closer it rapidly (more precisely, *exponentially*) approaches zero. Let $N$ represent the total number of rows in the data, and let $t$ represent a chosen term. If a certain word were to appear in **every** single complaint, then we would have $IDF(N, t) = log(\frac{N}{t}) = log(\frac{N}{N}) = log(1) = 0$, which would mean that when calculating $TF-IDF$, that specific word would have absolutely no weight attached to it when classifying complaints. </span>
<span id="cb30-333"><a href="#cb30-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-334"><a href="#cb30-334" aria-hidden="true" tabindex="-1"></a>Now; why do this? As discussed previously during the EDA section, almost 82% of all complaints fell into exactly three categories. Classification models will tend to stick to only a few categories, struggling to identify minor categories. While this may record higher accuracy scores on average, doing so means minor categories will rarely be classified at all, and in some instances, could lower overall accuracy if skew is significant enough. By ranking terms on an exponentially decreasing scale, we hope to reduce this issue. </span>
<span id="cb30-335"><a href="#cb30-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-336"><a href="#cb30-336" aria-hidden="true" tabindex="-1"></a>We first setup our <span class="in">`TfidfVectorizer`</span> and assign it to a variable, <span class="in">`tfidf`</span>. </span>
<span id="cb30-337"><a href="#cb30-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-338"><a href="#cb30-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE, warning=FALSE}</span></span>
<span id="cb30-339"><a href="#cb30-339" aria-hidden="true" tabindex="-1"></a>tfidf <span class="op">=</span> TfidfVectorizer(</span>
<span id="cb30-340"><a href="#cb30-340" aria-hidden="true" tabindex="-1"></a>  sublinear_tf <span class="op">=</span> <span class="va">True</span>, <span class="co"># Set term frequency to logarithmic scale</span></span>
<span id="cb30-341"><a href="#cb30-341" aria-hidden="true" tabindex="-1"></a>  min_df <span class="op">=</span> <span class="dv">5</span>, <span class="co"># Remove terms that appear less than 'min_df' times</span></span>
<span id="cb30-342"><a href="#cb30-342" aria-hidden="true" tabindex="-1"></a>  ngram_range <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">2</span>), <span class="co"># Unigrams and bigrams are considered </span></span>
<span id="cb30-343"><a href="#cb30-343" aria-hidden="true" tabindex="-1"></a>  stop_words <span class="op">=</span> <span class="st">'english'</span> <span class="co"># Use common English stop words</span></span>
<span id="cb30-344"><a href="#cb30-344" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-345"><a href="#cb30-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-346"><a href="#cb30-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-347"><a href="#cb30-347" aria-hidden="true" tabindex="-1"></a>From here, we can begin building our models, but before doing so, let's see what the most common terms were for each category. </span>
<span id="cb30-348"><a href="#cb30-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-349"><a href="#cb30-349" aria-hidden="true" tabindex="-1"></a>To do so, we use <span class="in">`tfidf.get_feature_names_out()`</span> on each category and assign that to a variable that we'll call **feature_names**. This contains all of the most common words associated with each category, which we then split into two separate lists for unigrams and bigrams (fancy words for "one word" and "two words"). From there, we print to console the $N = 3$ most common terms from each list. We wrap all this in a <span class="in">`for`</span> loop, automatically progressing through each category. </span>
<span id="cb30-350"><a href="#cb30-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-351"><a href="#cb30-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE, warning=FALSE}</span></span>
<span id="cb30-352"><a href="#cb30-352" aria-hidden="true" tabindex="-1"></a><span class="co"># Defaults </span></span>
<span id="cb30-353"><a href="#cb30-353" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> tfidf.fit_transform(df.description).toarray()</span>
<span id="cb30-354"><a href="#cb30-354" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> df.category_id</span>
<span id="cb30-355"><a href="#cb30-355" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb30-356"><a href="#cb30-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-357"><a href="#cb30-357" aria-hidden="true" tabindex="-1"></a><span class="co"># For Loop</span></span>
<span id="cb30-358"><a href="#cb30-358" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category, category_id <span class="kw">in</span> <span class="bu">sorted</span>(category_to_id.items()):</span>
<span id="cb30-359"><a href="#cb30-359" aria-hidden="true" tabindex="-1"></a>  features_chi2 <span class="op">=</span> chi2(features, labels <span class="op">==</span> category_id)</span>
<span id="cb30-360"><a href="#cb30-360" aria-hidden="true" tabindex="-1"></a>  indices <span class="op">=</span> np.argsort(features_chi2[<span class="dv">0</span>])</span>
<span id="cb30-361"><a href="#cb30-361" aria-hidden="true" tabindex="-1"></a>  feature_names <span class="op">=</span> np.array(tfidf.get_feature_names_out())[indices]</span>
<span id="cb30-362"><a href="#cb30-362" aria-hidden="true" tabindex="-1"></a>  unigrams <span class="op">=</span> [v <span class="cf">for</span> v <span class="kw">in</span> feature_names <span class="cf">if</span> <span class="bu">len</span>(v.split(<span class="st">' '</span>)) <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb30-363"><a href="#cb30-363" aria-hidden="true" tabindex="-1"></a>  bigrams <span class="op">=</span> [v <span class="cf">for</span> v <span class="kw">in</span> feature_names <span class="cf">if</span> <span class="bu">len</span>(v.split(<span class="st">' '</span>)) <span class="op">==</span> <span class="dv">2</span>]</span>
<span id="cb30-364"><a href="#cb30-364" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">==&gt; </span><span class="sc">%s</span><span class="st">:"</span> <span class="op">%</span>(Product)) <span class="co"># Space for formatting</span></span>
<span id="cb30-365"><a href="#cb30-365" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"  * Most Correlated Unigrams are: </span><span class="sc">%s</span><span class="st">"</span> <span class="op">%</span>(<span class="st">', '</span>.join(unigrams[<span class="op">-</span>N:])))</span>
<span id="cb30-366"><a href="#cb30-366" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"  * Most Correlated Bigrams are: </span><span class="sc">%s</span><span class="st">"</span> <span class="op">%</span>(<span class="st">', '</span>.join(bigrams[<span class="op">-</span>N:])))</span>
<span id="cb30-367"><a href="#cb30-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-368"><a href="#cb30-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-369"><a href="#cb30-369" aria-hidden="true" tabindex="-1"></a>As this part was performed offline, here is the output in screenshots.  </span>
<span id="cb30-370"><a href="#cb30-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-371"><a href="#cb30-371" aria-hidden="true" tabindex="-1"></a><span class="al">![](_images/term-correlation-1.png)</span></span>
<span id="cb30-372"><a href="#cb30-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-373"><a href="#cb30-373" aria-hidden="true" tabindex="-1"></a><span class="al">![](_images/term-correlation-2.png)</span></span>
<span id="cb30-374"><a href="#cb30-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-375"><a href="#cb30-375" aria-hidden="true" tabindex="-1"></a><span class="al">![](_images/term-correlation-3.png)</span></span>
<span id="cb30-376"><a href="#cb30-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-377"><a href="#cb30-377" aria-hidden="true" tabindex="-1"></a>The results are largely what we would expect, though there are some things to note. </span>
<span id="cb30-378"><a href="#cb30-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-379"><a href="#cb30-379" aria-hidden="true" tabindex="-1"></a>Some common phrases that appear for certain categories seemingly have nothing to do with them, such as the terms "77", "kindly", and "plz look", which is one of the most common bigrams for both "Education" and "Welfare Schemes." Remember, these were the categories that had less than 100 observations **total**. When we split the data to grab 15,000 random rows, these categories were split even further, which is probably why these nonsense phrases appear. </span>
<span id="cb30-380"><a href="#cb30-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-381"><a href="#cb30-381" aria-hidden="true" tabindex="-1"></a><span class="fu">### Building the Models </span></span>
<span id="cb30-382"><a href="#cb30-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-383"><a href="#cb30-383" aria-hidden="true" tabindex="-1"></a>To begin, we first split the data into a 75:25 training and test split. The model will "learn" how to classify grievances based on the training data, and then it will "test" its accuracy on the remaining 25%.</span>
<span id="cb30-384"><a href="#cb30-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-385"><a href="#cb30-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE, warning=FALSE}</span></span>
<span id="cb30-386"><a href="#cb30-386" aria-hidden="true" tabindex="-1"></a><span class="co"># We define them here as independent variables </span></span>
<span id="cb30-387"><a href="#cb30-387" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[<span class="st">"description"</span>]</span>
<span id="cb30-388"><a href="#cb30-388" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">"category"</span>]</span>
<span id="cb30-389"><a href="#cb30-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-390"><a href="#cb30-390" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size <span class="op">=</span> <span class="fl">0.25</span>, random_state <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb30-391"><a href="#cb30-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-392"><a href="#cb30-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-393"><a href="#cb30-393" aria-hidden="true" tabindex="-1"></a>There are several different models to choose from, but it's hard to know which will perform best before actually building them. That's why we'll test several models simultaneously by storing them in a list and looping through each model.</span>
<span id="cb30-394"><a href="#cb30-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-395"><a href="#cb30-395" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE, warning=FALSE}</span></span>
<span id="cb30-396"><a href="#cb30-396" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [</span>
<span id="cb30-397"><a href="#cb30-397" aria-hidden="true" tabindex="-1"></a>    RandomForestClassifier(n_estimators <span class="op">=</span> <span class="dv">100</span>, max_depth <span class="op">=</span> <span class="dv">5</span>, random_state <span class="op">=</span> <span class="dv">0</span>),</span>
<span id="cb30-398"><a href="#cb30-398" aria-hidden="true" tabindex="-1"></a>    LinearSVC(),</span>
<span id="cb30-399"><a href="#cb30-399" aria-hidden="true" tabindex="-1"></a>    MultinomialNB(),</span>
<span id="cb30-400"><a href="#cb30-400" aria-hidden="true" tabindex="-1"></a>    LogisticRegression(random_state <span class="op">=</span> <span class="dv">0</span>)    </span>
<span id="cb30-401"><a href="#cb30-401" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb30-402"><a href="#cb30-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-403"><a href="#cb30-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-404"><a href="#cb30-404" aria-hidden="true" tabindex="-1"></a>Here, we stored in a list the following:  </span>
<span id="cb30-405"><a href="#cb30-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-406"><a href="#cb30-406" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>Random Forest Model</span>
<span id="cb30-407"><a href="#cb30-407" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>Linear Support Vector Classifier Model</span>
<span id="cb30-408"><a href="#cb30-408" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>Multinomial Naive Bayes Model</span>
<span id="cb30-409"><a href="#cb30-409" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>Logistic Regression Model</span>
<span id="cb30-410"><a href="#cb30-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-411"><a href="#cb30-411" aria-hidden="true" tabindex="-1"></a>After, we apply each model to the training data and record the results. The accuracy of each model is inherently random, as model performance is somewhat due to chance, so we'll use a five-fold cross-validation and take the mean average of each iteration to get a more balanced result. We store the results in a <span class="in">`pandas`</span> dataframe for analysis. </span>
<span id="cb30-412"><a href="#cb30-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-413"><a href="#cb30-413" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE, warning=FALSE}</span></span>
<span id="cb30-414"><a href="#cb30-414" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy and pasted from before </span></span>
<span id="cb30-415"><a href="#cb30-415" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> tfidf.fit_transform(df.description).toarray()</span>
<span id="cb30-416"><a href="#cb30-416" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> df.category_id</span>
<span id="cb30-417"><a href="#cb30-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-418"><a href="#cb30-418" aria-hidden="true" tabindex="-1"></a>CV <span class="op">=</span> <span class="dv">5</span> <span class="co"># Number of cross-validations</span></span>
<span id="cb30-419"><a href="#cb30-419" aria-hidden="true" tabindex="-1"></a>cv_df <span class="op">=</span> pd.DataFrame(index <span class="op">=</span> <span class="bu">range</span>(CV <span class="op">*</span> <span class="bu">len</span>(models))) <span class="co"># CV dataframe</span></span>
<span id="cb30-420"><a href="#cb30-420" aria-hidden="true" tabindex="-1"></a>entries <span class="op">=</span> [] <span class="co"># Array for storing model results </span></span>
<span id="cb30-421"><a href="#cb30-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-422"><a href="#cb30-422" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model <span class="kw">in</span> models:</span>
<span id="cb30-423"><a href="#cb30-423" aria-hidden="true" tabindex="-1"></a>  model_name <span class="op">=</span> model.__class__.<span class="va">__name__</span></span>
<span id="cb30-424"><a href="#cb30-424" aria-hidden="true" tabindex="-1"></a>  accuracies <span class="op">=</span> cross_val_score(model, features, labels, scoring<span class="op">=</span><span class="st">'accuracy'</span>, cv<span class="op">=</span>CV)</span>
<span id="cb30-425"><a href="#cb30-425" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> fold_idx, accuracy <span class="kw">in</span> <span class="bu">enumerate</span>(accuracies):</span>
<span id="cb30-426"><a href="#cb30-426" aria-hidden="true" tabindex="-1"></a>    entries.append((model_name, fold_idx, accuracy))</span>
<span id="cb30-427"><a href="#cb30-427" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-428"><a href="#cb30-428" aria-hidden="true" tabindex="-1"></a>cv_df <span class="op">=</span> pd.DataFrame(entries, columns<span class="op">=</span>[<span class="st">'model_name'</span>, <span class="st">'fold_idx'</span>, <span class="st">'accuracy'</span>])</span>
<span id="cb30-429"><a href="#cb30-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-430"><a href="#cb30-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-431"><a href="#cb30-431" aria-hidden="true" tabindex="-1"></a><span class="fu">### Results </span></span>
<span id="cb30-432"><a href="#cb30-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-433"><a href="#cb30-433" aria-hidden="true" tabindex="-1"></a>Because we used a five-fold cross-validation, we have a total of 20 accuracy results - five for each model. We grab the mean accuracy and standard deviation for each model, storing them into a list. </span>
<span id="cb30-434"><a href="#cb30-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-435"><a href="#cb30-435" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE, warning=FALSE}</span></span>
<span id="cb30-436"><a href="#cb30-436" aria-hidden="true" tabindex="-1"></a>mean_accuracy <span class="op">=</span> cv_df.groupby(<span class="st">'model_name'</span>).accuracy.mean()</span>
<span id="cb30-437"><a href="#cb30-437" aria-hidden="true" tabindex="-1"></a>std_accuracy <span class="op">=</span> cv_df.groupby(<span class="st">'model_name'</span>).accuracy.std()</span>
<span id="cb30-438"><a href="#cb30-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-439"><a href="#cb30-439" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> pd.concat([mean_accuracy, std_accuracy], axis<span class="op">=</span> <span class="dv">1</span>, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-440"><a href="#cb30-440" aria-hidden="true" tabindex="-1"></a>accuracy.columns <span class="op">=</span> [<span class="st">'Mean Accuracy'</span>, <span class="st">'Standard Deviation'</span>]</span>
<span id="cb30-441"><a href="#cb30-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-442"><a href="#cb30-442" aria-hidden="true" tabindex="-1"></a>accuracy</span>
<span id="cb30-443"><a href="#cb30-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-444"><a href="#cb30-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-445"><a href="#cb30-445" aria-hidden="true" tabindex="-1"></a>| Model               | Mean Accuracy | Standard Deviation |</span>
<span id="cb30-446"><a href="#cb30-446" aria-hidden="true" tabindex="-1"></a>|---------------------|---------------|--------------------|</span>
<span id="cb30-447"><a href="#cb30-447" aria-hidden="true" tabindex="-1"></a>| Linear SVC          | 88.773%       | 0.368%             |</span>
<span id="cb30-448"><a href="#cb30-448" aria-hidden="true" tabindex="-1"></a>| Logistic Regression | 87.767%       | 0.433%             | </span>
<span id="cb30-449"><a href="#cb30-449" aria-hidden="true" tabindex="-1"></a>| Multinomial NB      | 85.720%       | 0.117%             |  </span>
<span id="cb30-450"><a href="#cb30-450" aria-hidden="true" tabindex="-1"></a>| Random Forest       | 66.213%       | 1.411%             | </span>
<span id="cb30-451"><a href="#cb30-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-452"><a href="#cb30-452" aria-hidden="true" tabindex="-1"></a>The top three models all performed similarly as well, all falling within 3.1% percentage points. The Linear Support Vector Classifier performed the best among the three, while the Random Forest performed atrociously. Standard deviation among the top three remained fairly low, but especially for multinomial naive bayes.  </span>
<span id="cb30-453"><a href="#cb30-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-454"><a href="#cb30-454" aria-hidden="true" tabindex="-1"></a><span class="fu">## Improvements </span></span>
<span id="cb30-455"><a href="#cb30-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-456"><a href="#cb30-456" aria-hidden="true" tabindex="-1"></a>We will focus model improvement on the Linear SVC because it performed the best. </span>
<span id="cb30-457"><a href="#cb30-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-458"><a href="#cb30-458" aria-hidden="true" tabindex="-1"></a>As a reminder, these were the three main considerations before going in. </span>
<span id="cb30-459"><a href="#cb30-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-460"><a href="#cb30-460" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Account for imbalances in number of occurrences per category. </span>
<span id="cb30-461"><a href="#cb30-461" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Consider reducing number of categories. </span>
<span id="cb30-462"><a href="#cb30-462" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Consider adding additional stopwords. </span>
<span id="cb30-463"><a href="#cb30-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-464"><a href="#cb30-464" aria-hidden="true" tabindex="-1"></a>To get a better idea of how our model performed, we will plot a **confusion matrix**, which displays the total number of attempts our classification model made along with how many were accurately categorized.</span>
<span id="cb30-465"><a href="#cb30-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-466"><a href="#cb30-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE}</span></span>
<span id="cb30-467"><a href="#cb30-467" aria-hidden="true" tabindex="-1"></a><span class="co"># Recreating LinearSVC Model </span></span>
<span id="cb30-468"><a href="#cb30-468" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test,indices_train,indices_test <span class="op">=</span> train_test_split(features, </span>
<span id="cb30-469"><a href="#cb30-469" aria-hidden="true" tabindex="-1"></a>                                                               labels, </span>
<span id="cb30-470"><a href="#cb30-470" aria-hidden="true" tabindex="-1"></a>                                                               df.index, test_size<span class="op">=</span><span class="fl">0.25</span>, </span>
<span id="cb30-471"><a href="#cb30-471" aria-hidden="true" tabindex="-1"></a>                                                               random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb30-472"><a href="#cb30-472" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LinearSVC()</span>
<span id="cb30-473"><a href="#cb30-473" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb30-474"><a href="#cb30-474" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_test)</span>
<span id="cb30-475"><a href="#cb30-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-476"><a href="#cb30-476" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion Matrix Plot</span></span>
<span id="cb30-477"><a href="#cb30-477" aria-hidden="true" tabindex="-1"></a>conf_mat <span class="op">=</span> confusion_matrix(y_test, y_pred)</span>
<span id="cb30-478"><a href="#cb30-478" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb30-479"><a href="#cb30-479" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_mat, annot <span class="op">=</span> <span class="va">True</span>, cmap <span class="op">=</span> <span class="st">"Greens"</span>, fmt <span class="op">=</span> <span class="st">'d'</span>,</span>
<span id="cb30-480"><a href="#cb30-480" aria-hidden="true" tabindex="-1"></a>            xticklabels <span class="op">=</span> category_id_df.category.values, </span>
<span id="cb30-481"><a href="#cb30-481" aria-hidden="true" tabindex="-1"></a>            yticklabels <span class="op">=</span> category_id_df.category.values)</span>
<span id="cb30-482"><a href="#cb30-482" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predicted"</span>)</span>
<span id="cb30-483"><a href="#cb30-483" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Actual"</span>)</span>
<span id="cb30-484"><a href="#cb30-484" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Confusion Matrix for LinearSVC </span><span class="ch">\n</span><span class="st">"</span>, size <span class="op">=</span> <span class="dv">20</span>)</span>
<span id="cb30-485"><a href="#cb30-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-486"><a href="#cb30-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-487"><a href="#cb30-487" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;center&gt;</span></span>
<span id="cb30-488"><a href="#cb30-488" aria-hidden="true" tabindex="-1"></a><span class="al">![](_images/heatmap.png)</span></span>
<span id="cb30-489"><a href="#cb30-489" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/center&gt;</span></span>
<span id="cb30-490"><a href="#cb30-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-491"><a href="#cb30-491" aria-hidden="true" tabindex="-1"></a>On the diagonal are the number of rows that the model correctly predicted for each category. The horizontals and verticals represent the number of incorrect guesses, with the vertical representing incorrect guesses for that specific category. For example, the model correctly classified 1,484 complaints as "Electrical," incorrectly classified 2 as "Electrical" when they should of been classified as "COVID-19," and classified 10 as "Road Maintenance" when they should of been classified as "Electrical." </span>
<span id="cb30-492"><a href="#cb30-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-493"><a href="#cb30-493" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modifications </span></span>
<span id="cb30-494"><a href="#cb30-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-495"><a href="#cb30-495" aria-hidden="true" tabindex="-1"></a>Looking at the chart, the top three categories dominate the total number of occurrences, comprising 2,969 rows out of 3,750 in our test data. Most of the incorrect predictions appear in the vertical of each of these three columns, meaning the model was incorrectly classifying complaints as them often. Even though we chose an algorithm to specifically downsample those categories, our model still has a tendency to over-predict them. </span>
<span id="cb30-496"><a href="#cb30-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-497"><a href="#cb30-497" aria-hidden="true" tabindex="-1"></a>A few categories have 12 or fewer observations: those being Markets, Estate, OFC, Welfare Schemes, Advertisement, Education, Town Planning, Lakes, and Parks and Playgrounds. Converting these will likely improve accuracy considering how poorly our model did at predicting them, but there isn't clear category to merge them with. Many of these categories seem to have been falsely labeled as "Road Maintenance." While converting these columns over to this might lead to higher accuracy, it doesn't really make any sense in this case, and likely would hurt performance in the future. </span>
<span id="cb30-498"><a href="#cb30-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-499"><a href="#cb30-499" aria-hidden="true" tabindex="-1"></a>We could reassign these variables to "Others," but that category performed *abysmally*, only correctly predicting 3 out of 43 complaints. On one hand, moving them there probably won't hurt, but it likely won't improve "Others" result either. </span>
<span id="cb30-500"><a href="#cb30-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-501"><a href="#cb30-501" aria-hidden="true" tabindex="-1"></a>Lakes and Advertisements, which the model predicted quite a few correctly, will be left untouched for now. For the remaining categories under 12 test observations, they will be merged in with Others.</span>
<span id="cb30-502"><a href="#cb30-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-503"><a href="#cb30-503" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE}</span></span>
<span id="cb30-504"><a href="#cb30-504" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Data | Copy and Paste from Above</span></span>
<span id="cb30-505"><a href="#cb30-505" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"bengaluru-grievances.csv"</span>)</span>
<span id="cb30-506"><a href="#cb30-506" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(df.category.unique()).values </span>
<span id="cb30-507"><a href="#cb30-507" aria-hidden="true" tabindex="-1"></a>character_limit <span class="op">=</span> (df[<span class="st">"description"</span>].<span class="bu">str</span>.<span class="bu">len</span>() <span class="op">&gt;</span> <span class="dv">12</span>)</span>
<span id="cb30-508"><a href="#cb30-508" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.loc[character_limit]</span>
<span id="cb30-509"><a href="#cb30-509" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sample(<span class="dv">15000</span>, random_state <span class="op">=</span> <span class="dv">2</span>).copy() <span class="co"># Select New Rows </span></span>
<span id="cb30-510"><a href="#cb30-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-511"><a href="#cb30-511" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Columns </span></span>
<span id="cb30-512"><a href="#cb30-512" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"category"</span>] <span class="op">=</span> df[<span class="st">"category"</span>].replace({<span class="st">'Markets'</span>: <span class="st">'Others'</span>})</span>
<span id="cb30-513"><a href="#cb30-513" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"category"</span>] <span class="op">=</span> df[<span class="st">"category"</span>].replace({<span class="st">'Estate'</span>: <span class="st">'Others'</span>})</span>
<span id="cb30-514"><a href="#cb30-514" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"category"</span>] <span class="op">=</span> df[<span class="st">"category"</span>].replace({<span class="st">'Welfare Schemes'</span>: <span class="st">'Others'</span>})</span>
<span id="cb30-515"><a href="#cb30-515" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"category"</span>] <span class="op">=</span> df[<span class="st">"category"</span>].replace({<span class="st">'Education'</span>: <span class="st">'Others'</span>})</span>
<span id="cb30-516"><a href="#cb30-516" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"category"</span>] <span class="op">=</span> df[<span class="st">"category"</span>].replace({<span class="st">'Town Planning'</span>: <span class="st">'Others'</span>})</span>
<span id="cb30-517"><a href="#cb30-517" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-518"><a href="#cb30-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-519"><a href="#cb30-519" aria-hidden="true" tabindex="-1"></a>"Optical Fiber Cables" and "Storm Water Drains," though, are directly related to "Road Maintenance," and if we look at the chart, that's what the model ended up incorrectly guessing the most of. For these categories, it makes more sense to convert them over to "Road Maintenance" as opposed to "Others." </span>
<span id="cb30-520"><a href="#cb30-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-521"><a href="#cb30-521" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE}</span></span>
<span id="cb30-522"><a href="#cb30-522" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"category"</span>] <span class="op">=</span> df[<span class="st">"category"</span>].replace({<span class="st">'Optical Fiber Cables (OFC)'</span>: <span class="st">'Road Maintenance(Engg)'</span>})</span>
<span id="cb30-523"><a href="#cb30-523" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"category"</span>] <span class="op">=</span> df[<span class="st">"category"</span>].replace({<span class="st">'Storm  Water Drain(SWD)'</span>: <span class="st">'Road Maintenance(Engg)'</span>})</span>
<span id="cb30-524"><a href="#cb30-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-525"><a href="#cb30-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-526"><a href="#cb30-526" aria-hidden="true" tabindex="-1"></a>While we've converted the total number of categories down from 20 to 13, we've only changed a total of 45 test rows. Even if the improved model were able to correctly predict all these observations now, we would only see an improvement of 1.2%. It's certainly not insignificant, but hardly substantial. Improving our stop word list, on the other hand, will hypothetically improve the accuracy of the model overall. </span>
<span id="cb30-527"><a href="#cb30-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-528"><a href="#cb30-528" aria-hidden="true" tabindex="-1"></a>Recall earlier when we found the most common unigrams and bigrams for each category. Several terms that appeared most often had little or nothing to do with their respective grievances, and should be able to be removed while maintaining or improving original accuracy. </span>
<span id="cb30-529"><a href="#cb30-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-530"><a href="#cb30-530" aria-hidden="true" tabindex="-1"></a>The original stop word list comes from another function in <span class="in">`sklearn`</span>, and already contains over 300 words. We want to keep those words while adding to it, so we will union them together in a new list and use it in <span class="in">`TfidfVectorizer`</span>.  </span>
<span id="cb30-531"><a href="#cb30-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-532"><a href="#cb30-532" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE}</span></span>
<span id="cb30-533"><a href="#cb30-533" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Function </span></span>
<span id="cb30-534"><a href="#cb30-534" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction <span class="im">import</span> text</span>
<span id="cb30-535"><a href="#cb30-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-536"><a href="#cb30-536" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Stop Words </span></span>
<span id="cb30-537"><a href="#cb30-537" aria-hidden="true" tabindex="-1"></a>stop_words <span class="op">=</span> text.ENGLISH_STOP_WORDS.union([<span class="st">"please"</span>, <span class="st">"plz"</span>, <span class="st">"look"</span>, <span class="st">"help"</span>, <span class="st">"causing"</span>, <span class="st">"coming"</span>, <span class="st">"kindly"</span>, <span class="st">"refused"</span>, <span class="st">"senior"</span>, <span class="st">"help"</span>, <span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span>, <span class="st">"also"</span>, <span class="st">"77"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"since"</span>])</span>
<span id="cb30-538"><a href="#cb30-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-539"><a href="#cb30-539" aria-hidden="true" tabindex="-1"></a><span class="co"># TfidfVectorizer </span></span>
<span id="cb30-540"><a href="#cb30-540" aria-hidden="true" tabindex="-1"></a>tfidf <span class="op">=</span> TfidfVectorizer(</span>
<span id="cb30-541"><a href="#cb30-541" aria-hidden="true" tabindex="-1"></a>  sublinear_tf <span class="op">=</span> <span class="va">True</span>, <span class="co"># Set term frequency to logarithmic scale</span></span>
<span id="cb30-542"><a href="#cb30-542" aria-hidden="true" tabindex="-1"></a>  min_df <span class="op">=</span> <span class="dv">5</span>, <span class="co"># Remove terms that appear less than 'min_df' times</span></span>
<span id="cb30-543"><a href="#cb30-543" aria-hidden="true" tabindex="-1"></a>  ngram_range <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">2</span>), <span class="co"># Keep unigrams and bigrams</span></span>
<span id="cb30-544"><a href="#cb30-544" aria-hidden="true" tabindex="-1"></a>  stop_words <span class="op">=</span> stop_words <span class="co"># Use custom stop words </span></span>
<span id="cb30-545"><a href="#cb30-545" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-546"><a href="#cb30-546" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-547"><a href="#cb30-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-548"><a href="#cb30-548" aria-hidden="true" tabindex="-1"></a><span class="fu">### Redo Text Preprocessing </span></span>
<span id="cb30-549"><a href="#cb30-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-550"><a href="#cb30-550" aria-hidden="true" tabindex="-1"></a>We have to redo the text preprocessing from earlier, so this is all copy-and-paste from before. </span>
<span id="cb30-551"><a href="#cb30-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-552"><a href="#cb30-552" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE}</span></span>
<span id="cb30-553"><a href="#cb30-553" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy and Paste</span></span>
<span id="cb30-554"><a href="#cb30-554" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'category_id'</span>] <span class="op">=</span> df[<span class="st">"category"</span>].factorize()[<span class="dv">0</span>]</span>
<span id="cb30-555"><a href="#cb30-555" aria-hidden="true" tabindex="-1"></a>category_id_df <span class="op">=</span> df[[<span class="st">"category"</span>, <span class="st">"category_id"</span>]].drop_duplicates()</span>
<span id="cb30-556"><a href="#cb30-556" aria-hidden="true" tabindex="-1"></a>category_to_id <span class="op">=</span> <span class="bu">dict</span>(category_id_df.values)</span>
<span id="cb30-557"><a href="#cb30-557" aria-hidden="true" tabindex="-1"></a>id_to_category <span class="op">=</span> <span class="bu">dict</span>(category_id_df[[<span class="st">"category_id"</span>, <span class="st">"category"</span>]].values)</span>
<span id="cb30-558"><a href="#cb30-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-559"><a href="#cb30-559" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> tfidf.fit_transform(df.description).toarray()</span>
<span id="cb30-560"><a href="#cb30-560" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> df.category_id</span>
<span id="cb30-561"><a href="#cb30-561" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[<span class="st">"description"</span>]</span>
<span id="cb30-562"><a href="#cb30-562" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">"category"</span>]</span>
<span id="cb30-563"><a href="#cb30-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-564"><a href="#cb30-564" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test,indices_train,indices_test <span class="op">=</span> train_test_split(</span>
<span id="cb30-565"><a href="#cb30-565" aria-hidden="true" tabindex="-1"></a>  features, </span>
<span id="cb30-566"><a href="#cb30-566" aria-hidden="true" tabindex="-1"></a>  labels, </span>
<span id="cb30-567"><a href="#cb30-567" aria-hidden="true" tabindex="-1"></a>  df.index, test_size <span class="op">=</span> <span class="fl">0.25</span>, </span>
<span id="cb30-568"><a href="#cb30-568" aria-hidden="true" tabindex="-1"></a>  random_state <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb30-569"><a href="#cb30-569" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LinearSVC()</span>
<span id="cb30-570"><a href="#cb30-570" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb30-571"><a href="#cb30-571" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_test)</span>
<span id="cb30-572"><a href="#cb30-572" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-573"><a href="#cb30-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-574"><a href="#cb30-574" aria-hidden="true" tabindex="-1"></a><span class="fu">### New Results </span></span>
<span id="cb30-575"><a href="#cb30-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-576"><a href="#cb30-576" aria-hidden="true" tabindex="-1"></a>We don't need the complicated <span class="in">`for`</span> loop from before because we only have one model this time. Therefore, we simply use <span class="in">`cross_val_score`</span> as we did before and print the results to console. </span>
<span id="cb30-577"><a href="#cb30-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-578"><a href="#cb30-578" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, eval=FALSE, echo=TRUE}</span></span>
<span id="cb30-579"><a href="#cb30-579" aria-hidden="true" tabindex="-1"></a>accuracy_svc <span class="op">=</span> cross_val_score(model, features, labels, scoring<span class="op">=</span><span class="st">'accuracy'</span>, cv<span class="op">=</span>CV)</span>
<span id="cb30-580"><a href="#cb30-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-581"><a href="#cb30-581" aria-hidden="true" tabindex="-1"></a>cv_mean_accuracy_svc <span class="op">=</span> accuracy_svc.mean()</span>
<span id="cb30-582"><a href="#cb30-582" aria-hidden="true" tabindex="-1"></a>cv_mean_std_svc <span class="op">=</span> accuracy_svc.std()</span>
<span id="cb30-583"><a href="#cb30-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-584"><a href="#cb30-584" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cv_mean_accuracy_svc <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb30-585"><a href="#cb30-585" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cv_mean_std_svc <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb30-586"><a href="#cb30-586" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-587"><a href="#cb30-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-588"><a href="#cb30-588" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;center&gt;</span></span>
<span id="cb30-589"><a href="#cb30-589" aria-hidden="true" tabindex="-1"></a><span class="al">![Results](_images/results.png)</span></span>
<span id="cb30-590"><a href="#cb30-590" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/center&gt;</span></span>
<span id="cb30-591"><a href="#cb30-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-592"><a href="#cb30-592" aria-hidden="true" tabindex="-1"></a>Our new Linear SVC model was able to achieve **91.987%** accuracy with an average standard deviation of *0.282%* across five iterations. That's an improvement of **3.214%** while also reducing variance within model performance by *0.086%*. </span>
<span id="cb30-593"><a href="#cb30-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-594"><a href="#cb30-594" aria-hidden="true" tabindex="-1"></a>Another way to look at these refinements; out of a possible **3,750** complaints, our model was able to correctly classify an additional *120* complaints, going from **3,328** correct predictions to **3,449**.  </span>
<span id="cb30-595"><a href="#cb30-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-596"><a href="#cb30-596" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;center&gt;</span></span>
<span id="cb30-597"><a href="#cb30-597" aria-hidden="true" tabindex="-1"></a><span class="al">![](_images/heatmap-2.png)</span></span>
<span id="cb30-598"><a href="#cb30-598" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/center&gt;</span></span>
<span id="cb30-599"><a href="#cb30-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-600"><a href="#cb30-600" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusions </span></span>
<span id="cb30-601"><a href="#cb30-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-602"><a href="#cb30-602" aria-hidden="true" tabindex="-1"></a>Once again, the top three categories performed similarly as well as before. Road maintenance was able to correctly predict an additional *63* complaints on this iteration. These three categories also continue to make up most of the incorrect predictions. </span>
<span id="cb30-603"><a href="#cb30-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-604"><a href="#cb30-604" aria-hidden="true" tabindex="-1"></a>The "Others" categories once again performed dreadfully, only recording an additional two correct predictions despite even more chances. Given it's a category meant to be all-emcompassing, it probably makes sense to manually reclassify those comaplaints into new or existing categories. </span>
<span id="cb30-605"><a href="#cb30-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-606"><a href="#cb30-606" aria-hidden="true" tabindex="-1"></a>Minor categories saw little or no improvement. The "Health Dept" was the only category that performed worse, dropping from 69.7% to 54.6% accuracy. The model incorrectly chose "Solid Waste" and "Road Maintenance" much more often than the previous model did, though it's unclear as to why this is. </span>
<span id="cb30-607"><a href="#cb30-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-608"><a href="#cb30-608" aria-hidden="true" tabindex="-1"></a>Increasing the stop word list seems to have improved accuracy overall. A more thorough list and additional adjustments might boost performance slightly more. </span>
<span id="cb30-609"><a href="#cb30-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-610"><a href="#cb30-610" aria-hidden="true" tabindex="-1"></a><span class="fu">## Source</span></span>
<span id="cb30-611"><a href="#cb30-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-612"><a href="#cb30-612" aria-hidden="true" tabindex="-1"></a>You can check out the Python source code for the MLE model <span class="co">[</span><span class="ot">here</span><span class="co">](https://github.com/Nathan-States/Bengaluru-Text-Mining)</span>. Download the full dataset <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.dolthub.com/repositories/bkowshik/bbmp-sahaaya)</span>.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../../license.html">License</a>
  </li>  
</ul>
    </div>   
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/nathanstates_">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://mastodon.social/@nathanstates_">
      <i class="bi bi-mastodon" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Nathan-States">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
      </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../../about.html">About</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../../contact.html">Contact</a>
  </li>  
</ul>
    </div>
  </div>
</footer>



<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>